System.register("bundle://main/_virtual/AudioManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventCenter.ts"],(function(e){var t,i,o,n,s,a,u,l,c,r,h,m,p;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,o=e.initializerDefineProperty,n=e.assertThisInitialized,s=e.createClass},function(e){a=e.cclegacy,u=e._decorator,l=e.AudioSource,c=e.resources,r=e.AudioClip,h=e.Component},function(e){m=e.EventCenter,p=e.GAME_EVENTS}],execute:function(){var f,d,_,g,b,S,M,v;a._RF.push({},"d72dfxkRE1KkqGuHRhoC2Ac","AudioManager",void 0);var y=u.ccclass,x=u.property,A={select:"audio/sfx_select",swap:"audio/sfx_swap",match:"audio/sfx_match",combo:"audio/sfx_combo",special:"audio/sfx_special",specialActivate:"audio/sfx_special_activate",levelComplete:"audio/sfx_level_complete",levelFailed:"audio/sfx_level_failed",button:"audio/sfx_button",star:"audio/sfx_star",noMatch:"audio/sfx_no_match"};e("AudioManager",(f=y("AudioManager"),d=x({range:[0,1,.1],slide:!0}),_=x({range:[0,1,.1],slide:!0}),f(((v=function(e){function t(){for(var t,i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return(t=e.call.apply(e,[this].concat(s))||this)._bgmSource=null,t._sfxSource=null,t._sfxCache=new Map,t._bgmClip=null,o(t,"bgmVolume",S,n(t)),o(t,"sfxVolume",M,n(t)),t._bgmMuted=!1,t._sfxMuted=!1,t}i(t,e);var a=t.prototype;return a.onLoad=function(){t._instance&&t._instance!==this?this.node.destroy():(t._instance=this,this._bgmSource=this.node.addComponent(l),this._bgmSource.loop=!0,this._bgmSource.playOnAwake=!1,this._bgmSource.volume=this.bgmVolume,this._sfxSource=this.node.addComponent(l),this._sfxSource.loop=!1,this._sfxSource.playOnAwake=!1,this._sfxSource.volume=this.sfxVolume,this.preloadAudio(),this.registerEvents(),console.log("[AudioManager] Initialized"))},a.onDestroy=function(){this.unregisterEvents(),t._instance===this&&(t._instance=null)},a.preloadAudio=function(){var e=this;c.load("audio/bgm_main",r,(function(t,i){t?console.warn("[AudioManager] Failed to load BGM:",t.message):(e._bgmClip=i,console.log("[AudioManager] BGM loaded"),e.playBGM())}));for(var t=Object.keys(A),i=function(){var i=t[o],n=A[i];c.load(n,r,(function(t,o){t?console.warn("[AudioManager] Failed to load SFX '"+i+"':",t.message):e._sfxCache.set(i,o)}))},o=0;o<t.length;o++)i()},a.registerEvents=function(){var e=m.instance;e.on(p.GEM_SWAPPED,this.onGemSwapped,this),e.on(p.MATCH_FOUND,this.onMatchFound,this),e.on(p.GEM_ELIMINATED,this.onGemEliminated,this),e.on(p.COMBO_TRIGGERED,this.onCombo,this),e.on(p.SPECIAL_ACTIVATED,this.onSpecialActivated,this),e.on(p.LEVEL_COMPLETE,this.onLevelComplete,this),e.on(p.LEVEL_FAILED,this.onLevelFailed,this),e.on(p.BOSS_DAMAGED,this.onBossDamaged,this)},a.unregisterEvents=function(){m.instance.targetOff(this)},a.playBGM=function(){this._bgmClip&&!this._bgmMuted&&(this._bgmSource.clip=this._bgmClip,this._bgmSource.volume=this.bgmVolume,this._bgmSource.play())},a.stopBGM=function(){this._bgmSource.stop()},a.pauseBGM=function(){this._bgmSource.pause()},a.resumeBGM=function(){this._bgmSource.play()},a.playSFX=function(e){if(!this._sfxMuted){var t=this._sfxCache.get(e);t&&this._sfxSource.playOneShot(t,this.sfxVolume)}},a.setBGMVolume=function(e){this.bgmVolume=Math.max(0,Math.min(1,e)),this._bgmSource.volume=this.bgmVolume},a.setSFXVolume=function(e){this.sfxVolume=Math.max(0,Math.min(1,e)),this._sfxSource.volume=this.sfxVolume},a.toggleBGMMute=function(){return this._bgmMuted=!this._bgmMuted,this._bgmMuted?this._bgmSource.pause():this._bgmSource.play(),this._bgmMuted},a.toggleSFXMute=function(){return this._sfxMuted=!this._sfxMuted,this._sfxMuted},a.onGemSwapped=function(){this.playSFX("swap")},a.onMatchFound=function(){this.playSFX("match")},a.onGemEliminated=function(){},a.onCombo=function(e){this.playSFX("combo")},a.onSpecialActivated=function(){this.playSFX("specialActivate")},a.onLevelComplete=function(){this.playSFX("levelComplete"),this._bgmSource.volume=.3*this.bgmVolume},a.onLevelFailed=function(){this.playSFX("levelFailed"),this._bgmSource.volume=.3*this.bgmVolume},a.onBossDamaged=function(){this.playSFX("specialActivate")},a.playButtonClick=function(){this.playSFX("button")},a.playSelect=function(){this.playSFX("select")},a.playNoMatch=function(){this.playSFX("noMatch")},a.playStar=function(){this.playSFX("star")},s(t,null,[{key:"instance",get:function(){return this._instance}}]),t}(h))._instance=null,S=t((b=v).prototype,"bgmVolume",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.4}}),M=t(b.prototype,"sfxVolume",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),g=b))||g));a._RF.pop()}}}));

System.register("bundle://main/_virtual/BoardManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameTypes.ts","./EventCenter.ts","./MatchEngine.ts","./FallEngine.ts","./SpecialGemFactory.ts","./DamageCalculator.ts","./LevelTypes.ts"],(function(t){var e,a,o,r,s,i,n,c,l,h,u,f,p,_,m,g,b,d,w,v;return{setters:[function(t){e=t.applyDecoratedDescriptor,a=t.inheritsLoose,o=t.initializerDefineProperty,r=t.assertThisInitialized,s=t.createForOfIteratorHelperLoose,i=t.createClass,n=t.asyncToGenerator,c=t.regeneratorRuntime},function(t){l=t.cclegacy,h=t._decorator,u=t.Component},function(t){f=t.createGemData,p=t.SpecialType},function(t){_=t.EventCenter,m=t.GAME_EVENTS},function(t){g=t.MatchEngine},function(t){b=t.FallEngine},function(t){d=t.SpecialGemFactory},function(t){w=t.DamageCalculator},function(t){v=t.ObstacleType}],execute:function(){var D,y,M,E,T;l._RF.push({},"441b11RnJxORbw3Hf8S1WbQ","BoardManager",void 0);var A=h.ccclass,x=h.property;t("BoardManager",A("BoardManager")((M=e((y=function(t){function e(){for(var e,a=arguments.length,s=new Array(a),i=0;i<a;i++)s[i]=arguments[i];return e=t.call.apply(t,[this].concat(s))||this,o(e,"rows",M,r(e)),o(e,"cols",E,r(e)),o(e,"gemTypes",T,r(e)),e._boardData=[],e._isProcessing=!1,e._config={rows:9,cols:7,gemTypes:6,gravity:"down"},e._score=0,e._movesLeft=30,e._combo=0,e}a(e,t);var l=e.prototype;return l.getGemAt=function(t,e){var a;return t<0||t>=this.rows||e<0||e>=this.cols?null:(null==(a=this._boardData[t])?void 0:a[e])||null},l.setMoves=function(t){this._movesLeft=t},l.setGemTypes=function(t){this._config.gemTypes=t,this.gemTypes=t},l.onLoad=function(){this._config.rows=this.rows,this._config.cols=this.cols,this._config.gemTypes=this.gemTypes},l.start=function(){},l.reset=function(){this._boardData=[],this._score=0,this._combo=0,this._movesLeft=30,this._isProcessing=!1},l.initBoard=function(t,e){t&&(t.rows&&(this.rows=t.rows,this._config.rows=t.rows),t.cols&&(this.cols=t.cols,this._config.cols=t.cols),t.gemTypes&&(this.gemTypes=t.gemTypes,this._config.gemTypes=t.gemTypes),t.gravity&&(this._config.gravity=t.gravity)),this._score=0,this._combo=0,this._boardData=[];for(var a=0;a<this.rows;a++){this._boardData[a]=[];for(var o=0;o<this.cols;o++){var r=void 0,s=0;do{var i=Math.floor(Math.random()*this.gemTypes);r=f(i,a,o),this._boardData[a][o]=r,s++}while(this.checkMatchAt(a,o)&&s<100)}}g.findAllMatches(this._boardData).length>0?this.initBoard(void 0,e):(e&&e.length>0&&this.applyObstacles(e),_.instance.emit("BOARD_INIT",this._boardData),console.log("Board Initialized"+(e?" with "+e.length+" obstacles":"")))},l.applyObstacles=function(t){for(var e,a=s(t);!(e=a()).done;){var o,r=e.value,i=r.row,n=r.col,c=r.type,l=r.hp;if(!(i<0||i>=this.rows||n<0||n>=this.cols)){var h=null==(o=this._boardData[i])?void 0:o[n];if(h)switch(c){case v.Ice:h.hp=l;break;case v.Chain:h.locked=!0;break;case v.Poison:h.poisoned=!0;break;default:h.hp=l}}}},l.checkMatchAt=function(t,e){var a=this._boardData[t][e];return!!a&&(e>=2&&this._boardData[t][e-1].color===a.color&&this._boardData[t][e-2].color===a.color||t>=2&&this._boardData[t-1][e].color===a.color&&this._boardData[t-2][e].color===a.color)},l.swapGems=function(){var t=n(c().mark((function t(e,a){var o,r,s,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this._isProcessing||this._movesLeft<=0)){t.next=2;break}return t.abrupt("return");case 2:if(g.isValidSwap(this._boardData,e,a)){t.next=5;break}return _.instance.emit("INVALID_SWAP",e,a),t.abrupt("return");case 5:return this._isProcessing=!0,this._movesLeft--,this._combo=0,_.instance.emit(m.SCORE_CHANGED,{score:this._score,movesLeft:this._movesLeft}),o=this._boardData[e.row][e.col],r=this._boardData[a.row][a.col],this._boardData[e.row][e.col]=r,this._boardData[a.row][a.col]=o,o.row=a.row,o.col=a.col,r.row=e.row,r.col=e.col,_.instance.emit(m.GEM_SWAPPED,e,a),t.next=20,this.wait(300);case 20:if(o.special===p.Normal||r.special===p.Normal){t.next=25;break}return t.next=23,this.processSpecialCombination(o,r);case 23:t.next=39;break;case 25:if(o.special===p.Normal&&r.special===p.Normal){t.next=37;break}return s=o.special!==p.Normal?o:r,i=o.special!==p.Normal?r:o,console.log("[BoardManager] Activating single special gem: "+p[s.special]+" at ("+s.row+","+s.col+")"),t.next=31,this.activateSpecialGem({row:s.row,col:s.col},i.color);case 31:return t.next=33,this.wait(300);case 33:return t.next=35,this.processMatchesAfterSpecial();case 35:t.next=39;break;case 37:return t.next=39,this.processMatches();case 39:this._isProcessing=!1;case 40:case"end":return t.stop()}}),t,this)})));return function(e,a){return t.apply(this,arguments)}}(),l.processMatches=function(){var t=n(c().mark((function t(){var e,a,o,r,i,n,l,h,u,v,D,y,M,E,T,A,x,L,k,S,C,G,N,I,P,B,O,F,R;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=0,a=!0;case 2:if(!a){t.next=31;break}if(0!==(o=g.findAllMatches(this._boardData)).length){t.next=7;break}return a=!1,t.abrupt("break",31);case 7:for(e++,this._combo=e,_.instance.emit(m.MATCH_FOUND,o),_.instance.emit(m.COMBO_TRIGGERED,e),r={atkBonus:1,critRate:.05,element:0},i={element:1,defense:0},n=s(o);!(l=n()).done;){for(h=l.value,u=w.calculateDamage(h,e,r,i),this._score+=u.totalDamage,_.instance.emit(m.DAMAGE_DEALT,u),h.specialToCreate!==p.Normal&&h.specialPosition,v=[],D=s(h.gems);!(y=D()).done;)M=y.value,h.specialToCreate!==p.Normal&&M.row===h.specialPosition.row&&M.col===h.specialPosition.col?((E=this._boardData[M.row][M.col]).special=h.specialToCreate,E.color=h.color,console.log("[BoardManager] Creating special gem: "+p[h.specialToCreate]+" at ("+M.row+","+M.col+"), color="+h.color),_.instance.emit("GEM_TRANSFORM",M,h.specialToCreate)):((T=this._boardData[M.row][M.col])&&T.special!==p.Normal&&(console.log("[BoardManager] Special gem eliminated in match: "+p[T.special]+" at ("+M.row+","+M.col+")"),v.push({pos:{row:M.row,col:M.col},specialType:T.special,color:T.color})),this._boardData[M.row][M.col]=null,_.instance.emit(m.GEM_ELIMINATED,M));for(A=0,x=v;A<x.length;A++)for(L=x[A],console.log("[BoardManager] Chain-activating "+p[L.specialType]+" at ("+L.pos.row+","+L.pos.col+")"),k=f(L.color,L.pos.row,L.pos.col,L.specialType),S=d.getActivationEffect(k,this._boardData),_.instance.emit(m.SPECIAL_ACTIVATED,k,S),C=s(S);!(G=C()).done;)I=G.value,null!=(N=this._boardData[I.row])&&N[I.col]&&(this._boardData[I.row][I.col]=null,_.instance.emit(m.GEM_ELIMINATED,I))}return t.next=16,this.wait(300);case 16:if(!((P=b.calculateFalls(this._boardData,this._config.gravity)).length>0)){t.next=21;break}return _.instance.emit("GEMS_FALL",P),t.next=21,this.wait(400);case 21:for(B=[],O=0;O<this.rows;O++)for(F=0;F<this.cols;F++)this._boardData[O][F]||B.push({row:O,col:F});if(!(B.length>0)){t.next=28;break}return R=b.generateNewGems(this._boardData,B,this._config),_.instance.emit("GEMS_SPAWN",R),t.next=28,this.wait(300);case 28:g.hasAvailableMoves(this._boardData)||this.shuffleBoard(),t.next=2;break;case 31:_.instance.emit(m.SCORE_CHANGED,{score:this._score,movesLeft:this._movesLeft}),_.instance.emit("TURN_COMPLETE",{score:this._score,movesLeft:this._movesLeft,combo:this._combo});case 33:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),l.activateSpecialGem=function(){var t=n(c().mark((function t(e,a){var o,r,i,n,l,h,u,f,g;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((o=this.getGemAt(e.row,e.col))&&o.special!==p.Normal){t.next=3;break}return t.abrupt("return");case 3:if(r=[],o.special===p.Star&&void 0!==a)for(i=0;i<this.rows;i++)for(n=0;n<this.cols;n++)(l=this._boardData[i][n])&&l.color===a&&r.push({row:i,col:n});else r=d.getActivationEffect(o,this._boardData);for(_.instance.emit(m.SPECIAL_ACTIVATED,o,r),h=s(r);!(u=h()).done;)g=u.value,null!=(f=this._boardData[g.row])&&f[g.col]&&(this._boardData[g.row][g.col]=null,_.instance.emit(m.GEM_ELIMINATED,g));case 7:case"end":return t.stop()}}),t,this)})));return function(e,a){return t.apply(this,arguments)}}(),l.processSpecialCombination=function(){var t=n(c().mark((function t(e,a){var o,r,i,n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=d.getCombinationEffect(e,a,this._boardData),_.instance.emit("SPECIAL_COMBINATION",e,a,o),t.next=4,this.wait(500);case 4:for(r=s(o);!(i=r()).done;)n=i.value,this._boardData[n.row][n.col]&&(this._boardData[n.row][n.col]=null,_.instance.emit(m.GEM_ELIMINATED,n));return t.next=7,this.processMatchesAfterSpecial();case 7:case"end":return t.stop()}}),t,this)})));return function(e,a){return t.apply(this,arguments)}}(),l.processMatchesAfterSpecial=function(){var t=n(c().mark((function t(){var e,a,o,r,s;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((e=b.calculateFalls(this._boardData,this._config.gravity)).length>0)){t.next=5;break}return _.instance.emit("GEMS_FALL",e),t.next=5,this.wait(400);case 5:for(a=[],o=0;o<this.rows;o++)for(r=0;r<this.cols;r++)this._boardData[o][r]||a.push({row:o,col:r});if(!(a.length>0)){t.next=12;break}return s=b.generateNewGems(this._boardData,a,this._config),_.instance.emit("GEMS_SPAWN",s),t.next=12,this.wait(300);case 12:return t.next=14,this.processMatches();case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),l.shuffleBoard=function(){for(var t=[],e=0;e<this.rows;e++)for(var a=0;a<this.cols;a++)this._boardData[e][a]&&t.push(this._boardData[e][a]);for(var o=t.length-1;o>0;o--){var r=Math.floor(Math.random()*(o+1)),s=[t[r],t[o]];t[o]=s[0],t[r]=s[1]}for(var i=0,n=0;n<this.rows;n++)for(var c=0;c<this.cols;c++)if(this._boardData[n][c]){var l=t[i++];l.row=n,l.col=c,this._boardData[n][c]=l}_.instance.emit("BOARD_SHUFFLE",this._boardData)},l.wait=function(t){return new Promise((function(e){return setTimeout(e,t)}))},i(e,[{key:"boardData",get:function(){return this._boardData}},{key:"isProcessing",get:function(){return this._isProcessing}},{key:"score",get:function(){return this._score}},{key:"movesLeft",get:function(){return this._movesLeft}},{key:"config",get:function(){return this._config}}]),e}(u)).prototype,"rows",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 9}}),E=e(y.prototype,"cols",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 7}}),T=e(y.prototype,"gemTypes",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 6}}),D=y))||D);l._RF.pop()}}}));

System.register("bundle://main/_virtual/BoardView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameTypes.ts","./EventCenter.ts","./BoardManager.ts","./AudioManager.ts"],(function(e){var t,i,o,n,s,a,r,l,h,c,g,d,m,p,u,S,v,f,w,_,C,z,y,T,M,N,E,P,A,I,G;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,o=e.initializerDefineProperty,n=e.assertThisInitialized,s=e.createForOfIteratorHelperLoose},function(e){a=e.cclegacy,r=e._decorator,l=e.Node,h=e.Vec2,c=e.Color,g=e.input,d=e.Input,m=e.Sprite,p=e.Graphics,u=e.Layers,S=e.UITransform,v=e.Label,f=e.tween,w=e.Vec3,_=e.Tween,C=e.UIOpacity,z=e.Component,y=e.resources,T=e.SpriteFrame,M=e.Texture2D},function(e){N=e.GemColor,E=e.SpecialType},function(e){P=e.EventCenter,A=e.GAME_EVENTS},function(e){I=e.BoardManager},function(e){G=e.AudioManager}],execute:function(){var L,O,b,R,B,F,D;a._RF.push({},"ec575PjJ2VEsLN8n5mnTT6s","BoardView",void 0);var U=r.ccclass,x=r.property;e("BoardView",(L=U("BoardView"),O=x(l),L((B=t((R=function(e){function t(){for(var t,i,s,a=arguments.length,r=new Array(a),l=0;l<a;l++)r[l]=arguments[l];return s=e.call.apply(e,[this].concat(r))||this,o(s,"gemLayer",B,n(s)),o(s,"gemSize",F,n(s)),o(s,"spacing",D,n(s)),s._gemNodes=[],s._selectedPos=null,s._isAnimating=!1,s._gemSprites={},s._specialSprites={},s._boardFrameNode=null,s._selectionRingNode=null,s._touchStartPos=new h,s._touchStartGridPos=null,s._isSwiping=!1,s._highlightNode=null,s._colorMap=((t={})[N.Red]=new c(231,76,60),t[N.Orange]=new c(243,156,18),t[N.Yellow]=new c(241,196,15),t[N.Green]=new c(46,204,113),t[N.Blue]=new c(52,152,219),t[N.Purple]=new c(155,89,182),t[N.Light]=new c(236,240,241),t[N.Dark]=new c(52,73,94),t[N.None]=new c(0,0,0,0),t),s._specialMarks=((i={})[E.Normal]="",i[E.Lightning]="âš¡",i[E.Bomb]="ðŸ’£",i[E.Star]="â­",i[E.BlackHole]="ðŸŒ€",i),s}i(t,e);var a=t.prototype;return a.onLoad=function(){this.loadGemResources(),P.instance.on("BOARD_INIT",this.onBoardInit,this),P.instance.on(A.GEM_SWAPPED,this.onGemSwapped,this),P.instance.on(A.MATCH_FOUND,this.onMatchFound,this),P.instance.on(A.GEM_ELIMINATED,this.onGemEliminated,this),P.instance.on("GEMS_FALL",this.onGemsFall,this),P.instance.on("GEMS_SPAWN",this.onGemsSpawn,this),P.instance.on("INVALID_SWAP",this.onInvalidSwap,this),P.instance.on("GEM_TRANSFORM",this.onGemTransform,this),P.instance.on("BOARD_SHUFFLE",this.onBoardShuffle,this),P.instance.on(A.DAMAGE_DEALT,this.onDamageDealt,this),P.instance.on(A.COMBO_TRIGGERED,this.onComboTriggered,this),g.on(d.EventType.TOUCH_START,this.onTouchStart,this),g.on(d.EventType.TOUCH_MOVE,this.onTouchMove,this),g.on(d.EventType.TOUCH_END,this.onTouchEnd,this),g.on(d.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},a.onDestroy=function(){P.instance.targetOff(this),g.off(d.EventType.TOUCH_START,this.onTouchStart,this),g.off(d.EventType.TOUCH_MOVE,this.onTouchMove,this),g.off(d.EventType.TOUCH_END,this.onTouchEnd,this),g.off(d.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},a.loadGemResources=function(){var e,t=this,i=((e={})[N.Red]="gem_red",e[N.Orange]="gem_orange",e[N.Yellow]="gem_yellow",e[N.Green]="gem_green",e[N.Blue]="gem_blue",e[N.Purple]="gem_purple",e[N.Light]="gem_light",e[N.Dark]="gem_dark",e),o=function(e){var o=i[e],n="gems/"+o+"/spriteFrame";y.load(n,T,(function(i,n){!i&&n?(t._gemSprites[e]=n,t.refreshGemSpritesForColor(Number(e))):y.load("gems/"+o+"/texture",M,(function(i,n){if(!i&&n){var s=new T;s.texture=n,t._gemSprites[e]=s,t.refreshGemSpritesForColor(Number(e))}else y.load("gems/"+o,M,(function(i,o){if(!i&&o){var n=new T;n.texture=o,t._gemSprites[e]=n,t.refreshGemSpritesForColor(Number(e))}}))}))}))};for(var n in i)o(n);this.loadSpecialGemResources()},a.loadSpecialGemResources=function(){var e,t=this,i=((e={})[E.Lightning]="special_lightning",e[E.Bomb]="special_bomb",e[E.Star]="special_star",e[E.BlackHole]="special_blackhole",e),o=function(e){var o=i[e],n="gems/special/"+o+"/spriteFrame";y.load(n,T,(function(i,n){!i&&n?(t._specialSprites[e]=n,console.log("[BoardView] Special sprite loaded: "+o)):y.load("gems/special/"+o+"/texture",M,(function(i,n){if(!i&&n){var s=new T;s.texture=n,t._specialSprites[e]=s,console.log("[BoardView] Special sprite loaded (texture): "+o)}else y.load("gems/special/"+o,M,(function(i,n){if(!i&&n){var s=new T;s.texture=n,t._specialSprites[e]=s,console.log("[BoardView] Special sprite loaded (raw): "+o)}}))}))}))};for(var n in i)o(n)},a.refreshGemSpritesForColor=function(e){var t,i=this._gemSprites[e];if(i)for(var o=this._gemNodes.length,n=o>0&&(null==(t=this._gemNodes[0])?void 0:t.length)||0,s=this.getLayoutOrigin(o,n),a=(s.startX,s.startY,0);a<o;a++)for(var r=0;r<((null==(h=this._gemNodes[a])?void 0:h.length)||0);r++){var h,g,d=null==(g=this._gemNodes[a])?void 0:g[r];if(d&&d.isValid&&!d.getComponent(m)){var f=d.name.split("_");if((f.length>=4?Number(f[3]):-1)===e&&d.getComponent(p)){var w=d.position.clone(),_=d.scale.clone();d.removeFromParent(),d.destroy();var C=new l("Gem_"+a+"_"+r+"_"+e);C.layer=u.Enum.UI_2D;var z=C.addComponent(S);z.setContentSize(this.gemSize,this.gemSize);var y=C.addComponent(m);y.type=m.Type.SIMPLE,y.sizeMode=m.SizeMode.CUSTOM,y.spriteFrame=i,z.setContentSize(this.gemSize,this.gemSize);var T=new l("Label");T.layer=u.Enum.UI_2D,T.addComponent(S).setContentSize(this.gemSize,this.gemSize);var M=T.addComponent(v);M.string="",M.fontSize=32,M.color=new c(255,255,255,255),M.horizontalAlign=v.HorizontalAlign.CENTER,M.verticalAlign=v.VerticalAlign.CENTER,M.overflow=v.Overflow.CLAMP,M.enableOutline=!0,M.outlineColor=new c(0,0,0,200),M.outlineWidth=3,C.addChild(T),C.setPosition(w),C.setScale(_),this.gemLayer.addChild(C),this._gemNodes[a][r]=C}}}},a.onBoardInit=function(e){console.log("BoardView: Init"),this.gemLayer.removeAllChildren(),this._gemNodes=[],this._selectedPos=null,this._highlightNode=null,this._boardFrameNode=null,this._selectionRingNode=null;var t=e.length,i=e[0].length;this.computeGemSize(t,i),console.log("[BoardView] Dynamic gemSize = "+this.gemSize+", board = "+t+"x"+i);var o=this.getLayoutOrigin(t,i),n=o.startX,s=o.startY;this.drawBoardFrame(t,i,n,s);for(var a=0;a<t;a++){this._gemNodes[a]=[];for(var r=0;r<i;r++){var l=e[a][r];l&&l.color!==N.None?this.createGemNode(l,n,s):this._gemNodes[a][r]=null}}},a.drawBoardFrame=function(e,t,i,o){var n=t*(this.gemSize+this.spacing)-this.spacing+32,s=e*(this.gemSize+this.spacing)-this.spacing+32,a=i+(t-1)*(this.gemSize+this.spacing)/2,r=o-(e-1)*(this.gemSize+this.spacing)/2,h=new l("BoardFrame");h.layer=u.Enum.UI_2D,h.addComponent(S).setContentSize(n,s),h.setPosition(a,r,0);var g=h.addComponent(p),d=20,m=-n/2,v=-s/2;g.fillColor=new c(255,255,255,35),g.moveTo(m+d,v),g.lineTo(m+n-d,v),g.arc(m+n-d,v+d,d,-Math.PI/2,0,!1),g.lineTo(m+n,v+s-d),g.arc(m+n-d,v+s-d,d,0,Math.PI/2,!1),g.lineTo(m+d,v+s),g.arc(m+d,v+s-d,d,Math.PI/2,Math.PI,!1),g.lineTo(m,v+d),g.arc(m+d,v+d,d,Math.PI,1.5*Math.PI,!1),g.close(),g.fill(),g.strokeColor=new c(255,255,255,70),g.lineWidth=2,g.moveTo(m+d,v),g.lineTo(m+n-d,v),g.arc(m+n-d,v+d,d,-Math.PI/2,0,!1),g.lineTo(m+n,v+s-d),g.arc(m+n-d,v+s-d,d,0,Math.PI/2,!1),g.lineTo(m+d,v+s),g.arc(m+d,v+s-d,d,Math.PI/2,Math.PI,!1),g.lineTo(m,v+d),g.arc(m+d,v+d,d,Math.PI,1.5*Math.PI,!1),g.close(),g.stroke(),this.gemLayer.insertChild(h,0),this._boardFrameNode=h},a.computeGemSize=function(e,t){var i=720,o=1280,n=this.gemLayer.parent;if(n){var s=n.getComponent(S);s&&(i=s.contentSize.width,o=s.contentSize.height)}if(i>o){var a=i;i=o,o=a}console.log("[BoardView] Screen size: "+i+"x"+o);var r=.55*o,l=.88*i,h=Math.floor((r-(e-1)*this.spacing)/e),c=Math.floor((l-(t-1)*this.spacing)/t);this.gemSize=Math.min(h,c),this.gemSize<60&&(this.gemSize=60)},a.createGemNode=function(e,t,i){var o=new l("Gem_"+e.row+"_"+e.col+"_"+e.color);o.layer=u.Enum.UI_2D;var n=o.addComponent(S);n.setContentSize(this.gemSize,this.gemSize);var s=e.special!==E.Normal,a=s?this._specialSprites[e.special]:null,r=this._gemSprites[e.color];if(a){var h=o.addComponent(m);h.type=m.Type.SIMPLE,h.sizeMode=m.SizeMode.CUSTOM,h.spriteFrame=a,n.setContentSize(this.gemSize,this.gemSize)}else if(r){var g=o.addComponent(m);g.type=m.Type.SIMPLE,g.sizeMode=m.SizeMode.CUSTOM,g.spriteFrame=r,n.setContentSize(this.gemSize,this.gemSize)}else{var d=o.addComponent(p),_=this._colorMap[e.color]||c.WHITE;d.fillColor=_;var C=this.gemSize/2;d.roundRect(-C,-C,this.gemSize,this.gemSize,8),d.fill()}if(s&&!a){var z=new l("Label");z.layer=u.Enum.UI_2D,z.addComponent(S).setContentSize(this.gemSize,this.gemSize);var y=z.addComponent(v),T=this._specialMarks[e.special]||"";y.string=T,y.fontSize=38,y.color=new c(255,255,255,255),y.horizontalAlign=v.HorizontalAlign.CENTER,y.verticalAlign=v.VerticalAlign.CENTER,y.overflow=v.Overflow.CLAMP,y.enableOutline=!0,y.outlineColor=new c(0,0,0,200),y.outlineWidth=3,o.addChild(z)}var M=t+e.col*(this.gemSize+this.spacing),N=i-e.row*(this.gemSize+this.spacing);o.setPosition(M,N,0),this.gemLayer.addChild(o),this._gemNodes[e.row][e.col]=o;var P=2*Math.random();f(o).delay(P).to(1.2+.6*Math.random(),{scale:new w(1.03,1.03,1)},{easing:"sineInOut"}).to(1.2+.6*Math.random(),{scale:new w(1,1,1)},{easing:"sineInOut"}).union().repeatForever().tag(99).start(),e.locked&&this.renderObstacleOverlay(o,"chain"),e.hp&&e.hp>1&&this.renderObstacleOverlay(o,"ice",e.hp-1)},a.renderObstacleOverlay=function(e,t,i){void 0===i&&(i=1);var o=new l("Overlay_"+t);o.layer=u.Enum.UI_2D,o.addComponent(S).setContentSize(this.gemSize,this.gemSize);var n=o.addComponent(p),s=this.gemSize/2;if("ice"===t){var a=Math.min(120+40*i,200);if(n.fillColor=new c(180,220,255,a),n.roundRect(-s,-s,this.gemSize,this.gemSize,8),n.fill(),n.strokeColor=new c(255,255,255,180),n.lineWidth=1.5,n.moveTo(.5*-s,.6*s),n.lineTo(0,0),n.lineTo(.4*s,.3*-s),n.moveTo(0,0),n.lineTo(.2*-s,.5*-s),n.stroke(),i>1){var r=new l("IceCount");r.layer=u.Enum.UI_2D,r.addComponent(S).setContentSize(this.gemSize,this.gemSize);var h=r.addComponent(v);h.string=""+i,h.fontSize=20,h.color=new c(255,255,255,240),h.horizontalAlign=v.HorizontalAlign.CENTER,h.verticalAlign=v.VerticalAlign.CENTER,h.enableOutline=!0,h.outlineColor=new c(50,100,180,200),h.outlineWidth=2,o.addChild(r)}}else{n.fillColor=new c(60,60,60,100),n.roundRect(-s,-s,this.gemSize,this.gemSize,8),n.fill(),n.strokeColor=new c(100,100,100,220),n.lineWidth=3,n.moveTo(.7*-s,.7*-s),n.lineTo(.7*s,.7*s),n.moveTo(.7*s,.7*-s),n.lineTo(.7*-s,.7*s),n.stroke();var g=new l("LockIcon");g.layer=u.Enum.UI_2D,g.addComponent(S).setContentSize(this.gemSize,this.gemSize);var d=g.addComponent(v);d.string="ðŸ”’",d.fontSize=24,d.horizontalAlign=v.HorizontalAlign.CENTER,d.verticalAlign=v.VerticalAlign.CENTER,o.addChild(g)}e.addChild(o)},a.onComboTriggered=function(e){if(!(e<3)&&this.gemLayer){var t=Math.min(2*e,16),i=this.gemLayer,o=i.position.clone();f(i).to(.03,{position:new w(o.x+t,o.y+.6*t,o.z)}).to(.03,{position:new w(o.x-.8*t,o.y-.4*t,o.z)}).to(.03,{position:new w(o.x+.5*t,o.y-.3*t,o.z)}).to(.03,{position:new w(o.x-.3*t,o.y+.2*t,o.z)}).to(.03,{position:o}).start()}},a.onTouchStart=function(e){if(!this._isAnimating){var t=e.getUILocation();this._touchStartPos.set(t.x,t.y),this._isSwiping=!1;var i=this.screenToGrid(t.x,t.y);this._touchStartGridPos=i}},a.onTouchMove=function(e){if(!this._isAnimating&&this._touchStartGridPos&&!this._isSwiping){var t=e.getUILocation(),i=t.x-this._touchStartPos.x,o=t.y-this._touchStartPos.y;Math.sqrt(i*i+o*o)>=30&&(this._isSwiping=!0,this.handleSwipe(this._touchStartGridPos,i,o))}},a.onTouchEnd=function(e){this._isAnimating||(!this._isSwiping&&this._touchStartGridPos&&this.handleGemClick(this._touchStartGridPos.row,this._touchStartGridPos.col),this._touchStartGridPos=null,this._isSwiping=!1)},a.screenToGrid=function(e,t){var i,o=this.gemLayer.getComponent(S);if(!o||0===this._gemNodes.length)return null;var n=o.convertToNodeSpaceAR(new w(e,t,0)),s=this._gemNodes.length,a=(null==(i=this._gemNodes[0])?void 0:i.length)||0,r=-(a*(this.gemSize+this.spacing)-this.spacing)/2,l=(s*(this.gemSize+this.spacing)-this.spacing)/2,h=Math.floor((n.x-r)/(this.gemSize+this.spacing)),c=Math.floor((l-n.y)/(this.gemSize+this.spacing));return c>=0&&c<s&&h>=0&&h<a?{row:c,col:h}:null},a.handleSwipe=function(e,t,i){var o,n=e.row,s=e.col;Math.abs(t)>Math.abs(i)?s+=t>0?1:-1:n+=i>0?-1:1,this.clearSelection();var a=this._gemNodes.length,r=(null==(o=this._gemNodes[0])?void 0:o.length)||0;n<0||n>=a||s<0||s>=r||this.trySwap(e,{row:n,col:s})},a.handleGemClick=function(e,t){if(this._selectedPos){var i=this._selectedPos;if(this.clearSelection(),i.row===e&&i.col===t)return void(this._selectedPos=null);var o=Math.abs(i.row-e),n=Math.abs(i.col-t);if(!(1===o&&0===n||0===o&&1===n))return this._selectedPos={row:e,col:t},void this.showSelection(e,t);this.trySwap(i,{row:e,col:t}),this._selectedPos=null}else{var s;this._selectedPos={row:e,col:t},this.showSelection(e,t),null==(s=G.instance)||s.playSelect()}},a.trySwap=function(e,t){var i,o=this.getComponent(I)||(null==(i=this.node.parent)?void 0:i.getComponentInChildren(I));o?o.swapGems(e,t):console.warn("BoardManager not found!")},a.showSelection=function(e,t){var i;this.clearSelection();var o=null==(i=this._gemNodes[e])?void 0:i[t];if(o){_.stopAllByTarget(o),f(o).to(.15,{scale:new w(1.12,1.12,1)}).to(.15,{scale:new w(1.04,1.04,1)}).union().repeatForever().start();var n=new l("SelectionRing");n.layer=u.Enum.UI_2D;var s=this.gemSize+12;n.addComponent(S).setContentSize(s,s);var a=n.addComponent(p),r=14,h=s/2;a.strokeColor=new c(255,230,80,220),a.lineWidth=3,a.moveTo(-h+r,-h),a.lineTo(h-r,-h),a.arc(h-r,-h+r,r,-Math.PI/2,0,!1),a.lineTo(h,h-r),a.arc(h-r,h-r,r,0,Math.PI/2,!1),a.lineTo(-h+r,h),a.arc(-h+r,h-r,r,Math.PI/2,Math.PI,!1),a.lineTo(-h,-h+r),a.arc(-h+r,-h+r,r,Math.PI,1.5*Math.PI,!1),a.close(),a.stroke(),n.setPosition(o.position.clone()),n.addComponent(C).opacity=255,this.gemLayer.addChild(n);var g=n.getComponent(C);f(g).to(.5,{opacity:120}).to(.5,{opacity:255}).union().repeatForever().start(),this._selectionRingNode=n,this._highlightNode=o}},a.clearSelection=function(){if(this._highlightNode){_.stopAllByTarget(this._highlightNode),this._highlightNode.setScale(1,1,1);var e=this._highlightNode,t=.5*Math.random();f(e).delay(t).to(1.2+.6*Math.random(),{scale:new w(1.03,1.03,1)},{easing:"sineInOut"}).to(1.2+.6*Math.random(),{scale:new w(1,1,1)},{easing:"sineInOut"}).union().repeatForever().tag(99).start(),this._highlightNode=null}this._selectionRingNode&&(_.stopAllByTarget(this._selectionRingNode),this._selectionRingNode.destroy(),this._selectionRingNode=null),this._selectedPos=null},a.onGemSwapped=function(e,t){var i,o,n=this;this._isAnimating=!0;var s=null==(i=this._gemNodes[e.row])?void 0:i[e.col],a=null==(o=this._gemNodes[t.row])?void 0:o[t.col];this._gemNodes[e.row]&&this._gemNodes[t.row]&&(this._gemNodes[e.row][e.col]=a,this._gemNodes[t.row][t.col]=s);var r=0,l=function(){++r>=2&&(n._isAnimating=!1)};s?this.tweenMove(s,t.row,t.col,.2,l):l(),a?this.tweenMove(a,e.row,e.col,.2,l):l()},a.onInvalidSwap=function(e,t){var i,o;null==(i=G.instance)||i.playNoMatch();var n=null==(o=this._gemNodes[e.row])?void 0:o[e.col];if(n){var s=n.position.clone();f(n).to(.05,{position:new w(s.x+6,s.y,0)}).to(.05,{position:new w(s.x-6,s.y,0)}).to(.05,{position:new w(s.x+3,s.y,0)}).to(.05,{position:s}).start()}},a.onMatchFound=function(e){this._isAnimating=!0},a.onGemEliminated=function(e){var t,i=null==(t=this._gemNodes[e.row])?void 0:t[e.col];if(i){var o=this.getGemColor(i),n=i.position.clone(),s=new l("Flash"),a=s.addComponent(p);s.getComponent(S).setContentSize(this.gemSize,this.gemSize),a.fillColor=new c(255,255,255,200),a.rect(-this.gemSize/2,-this.gemSize/2,this.gemSize,this.gemSize),a.fill(),s.setPosition(n),s.addComponent(C).opacity=255,this.gemLayer.addChild(s);var r=s.getComponent(C);f(r).to(.2,{opacity:0}).call((function(){s.destroy()})).start(),this.spawnParticleBurst(n,o),f(i).to(.12,{scale:new w(1.3,1.3,1)}).to(.1,{scale:new w(0,0,1)}).call((function(){i.destroy()})).start(),this._gemNodes[e.row][e.col]=null}},a.onGemTransform=function(e,t){var i,o=null==(i=this._gemNodes[e.row])?void 0:i[e.col];if(o&&o.isValid){console.log("[BoardView] GEM_TRANSFORM at ("+e.row+","+e.col+") â†’ "+E[t]),f(o).to(.1,{scale:new w(1.6,1.6,1)}).to(.1,{scale:new w(.8,.8,1)}).to(.1,{scale:new w(1.15,1.15,1)}).to(.08,{scale:new w(1,1,1)}).start();var n=this._specialSprites[t];if(n){var s=o.getComponent(m);if(s){s.spriteFrame=n;var a=o.getComponent(S);a&&a.setContentSize(this.gemSize,this.gemSize)}var r=o.getChildByName("Label");r&&r.destroy()}else{var h=o.getChildByName("Label");if(!h){(h=new l("Label")).layer=u.Enum.UI_2D,h.addComponent(S).setContentSize(this.gemSize,this.gemSize);var g=h.addComponent(v);g.fontSize=38,g.color=new c(255,255,255,255),g.horizontalAlign=v.HorizontalAlign.CENTER,g.verticalAlign=v.VerticalAlign.CENTER,g.overflow=v.Overflow.CLAMP,g.enableOutline=!0,g.outlineColor=new c(0,0,0,200),g.outlineWidth=3,o.addChild(h)}var d=h.getComponent(v);d&&(d.string=this._specialMarks[t]||"â˜…",d.fontSize=38)}}},a.onGemsFall=function(e){var t=this;this._isAnimating=!0;for(var i,o=0,n=function(){--o<=0&&(t._isAnimating=!1)},a=s(e);!(i=a()).done;){var r,l=i.value;if(!l.isNew){var h=null==(r=this._gemNodes[l.fromRow])?void 0:r[l.fromCol];h&&(this._gemNodes[l.toRow][l.toCol]=h,this._gemNodes[l.fromRow][l.fromCol]=null,o++,this.tweenMove(h,l.toRow,l.toCol,.25,n))}}0===o&&(this._isAnimating=!1)},a.onGemsSpawn=function(e){var t=this;if(0!==this._gemNodes.length){var i=this._gemNodes.length,o=this._gemNodes[0].length,n=this.getLayoutOrigin(i,o),a=n.startX,r=n.startY;this._isAnimating=!0;for(var l,h=e.length,c=function(){--h<=0&&(t._isAnimating=!1)},g=s(e);!(l=g()).done;){var d,m=l.value;this.createGemNode(m,a,r);var p=null==(d=this._gemNodes[m.row])?void 0:d[m.col];if(p){var u=p.position.y;p.setPosition(p.position.x,u+3*this.gemSize,0),p.setScale(.5,.5,1),f(p).to(.35,{position:new w(p.position.x,u,0),scale:new w(1,1,1)}).call(c).start()}else c()}0===e.length&&(this._isAnimating=!1)}},a.onBoardShuffle=function(e){this.onBoardInit(e)},a.getLayoutOrigin=function(e,t){var i=t*(this.gemSize+this.spacing)-this.spacing,o=e*(this.gemSize+this.spacing)-this.spacing;return{startX:-i/2+this.gemSize/2,startY:o/2-this.gemSize/2-60}},a.tweenMove=function(e,t,i,o,n){var s;void 0===o&&(o=.2);var a=this._gemNodes.length,r=(null==(s=this._gemNodes[0])?void 0:s.length)||0,l=this.getLayoutOrigin(a,r),h=l.startX,c=l.startY,g=h+i*(this.gemSize+this.spacing),d=c-t*(this.gemSize+this.spacing),m=f(e).to(o,{position:new w(g,d,0)});n&&m.call(n),m.start()},a.getGemColor=function(e){var t=e.getComponent(m);if(t)return t.color.clone();var i=e.getComponent(p);return i?i.fillColor.clone():new c(200,200,255)},a.spawnParticleBurst=function(e,t){for(var i=this,o=function(){var o=new l("Particle"),s=4+6*Math.random(),a=o.addComponent(p);o.getComponent(S).setContentSize(2*s,2*s),a.fillColor=new c(Math.min(255,t.r+40),Math.min(255,t.g+40),Math.min(255,t.b+40),255),a.circle(0,0,s),a.fill(),a.fillColor=new c(t.r,t.g,t.b,80),a.circle(0,0,1.8*s),a.fill(),o.setPosition(e),o.addComponent(C).opacity=255,i.gemLayer.addChild(o);var r=2*Math.PI/6*n+.5*(Math.random()-.5),h=40+50*Math.random(),g=e.x+Math.cos(r)*h,d=e.y+Math.sin(r)*h,m=o.getComponent(C);f(o).to(.35,{position:new w(g,d,0),scale:new w(.3,.3,1)}).start(),f(m).delay(.15).to(.2,{opacity:0}).call((function(){o.destroy()})).start()},n=0;n<6;n++)o()},a.onDamageDealt=function(e){if(e&&e.damage){var t=0,i=0;if(e.position){var o,n=this._gemNodes.length,s=(null==(o=this._gemNodes[0])?void 0:o.length)||0,a=this.getLayoutOrigin(n,s),r=a.startX,l=a.startY;t=r+e.position.col*(this.gemSize+this.spacing),i=l-e.position.row*(this.gemSize+this.spacing)}this.spawnScoreFlyout(t,i,e.damage)}},a.spawnScoreFlyout=function(e,t,i){var o=new l("ScoreFly");o.setPosition(e,t+20,0),o.setScale(.5,.5,1);var n=o.addComponent(v);o.getComponent(S).setContentSize(120,40),n.string="+"+i,n.fontSize=30,n.lineHeight=36,n.color=new c(255,230,80),n.isBold=!0,n.enableOutline=!0,n.outlineColor=new c(0,0,0,180),n.outlineWidth=2,o.addComponent(C).opacity=255,this.gemLayer.addChild(o);var s=o.getComponent(C);f(o).to(.15,{scale:new w(1.2,1.2,1)},{easing:"backOut"}).to(.1,{scale:new w(1,1,1)}).to(.6,{position:new w(e,t+80,0)}).call((function(){o.destroy()})).start(),f(s).delay(.5).to(.35,{opacity:0}).start()},t}(z)).prototype,"gemLayer",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(R.prototype,"gemSize",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 130}}),D=t(R.prototype,"spacing",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),b=R))||b));a._RF.pop()}}}));

System.register("bundle://main/_virtual/BossManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventCenter.ts","./BoardManager.ts","./LevelTypes.ts"],(function(t){var e,s,o,i,a,n,r,l,c,h,S,u,d;return{setters:[function(t){e=t.applyDecoratedDescriptor,s=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized,a=t.createForOfIteratorHelperLoose,n=t.createClass},function(t){r=t.cclegacy,l=t._decorator,c=t.Component},function(t){h=t.EventCenter,S=t.GAME_EVENTS},function(t){u=t.BoardManager},function(t){d=t.BossSkillType}],execute:function(){var _,f,b,p,m;r._RF.push({},"86ac7u9O9lK1qNfVdyxeYGw","BossManager",void 0);var g=l.ccclass,k=l.property,v=t("BOSS_EVENTS",{BOSS_INIT:"boss:init",BOSS_DAMAGED:"boss:damaged",BOSS_SKILL:"boss:skill",BOSS_DEFEATED:"boss:defeated",BOSS_HP_CHANGED:"boss:hp_changed",BOSS_SHIELD:"boss:shield",BOSS_TURN:"boss:turn"});t("BossManager",(_=g("BossManager"),f=k(u),_((m=e((p=function(t){function e(){for(var e,s=arguments.length,a=new Array(s),n=0;n<s;n++)a[n]=arguments[n];return e=t.call.apply(t,[this].concat(a))||this,o(e,"boardManager",m,i(e)),e._bossState=null,e}s(e,t);var r=e.prototype;return r.onLoad=function(){h.instance.on(S.DAMAGE_DEALT,this.onDamageDealt,this),h.instance.on(S.SCORE_CHANGED,this.onTurnEnd,this)},r.onDestroy=function(){h.instance.targetOff(this)},r.initBoss=function(t){this._bossState={config:t,currentHp:t.maxHp,skillCooldowns:t.skills.map((function(){return 0})),shield:0,turnCount:0,defeated:!1},h.instance.emit(v.BOSS_INIT,this._bossState),console.log('Boss "'+t.name+'" initialized. HP: '+t.maxHp)},r.onDamageDealt=function(t){if(this._bossState&&!this._bossState.defeated){var e=t.totalDamage;if(this._bossState.shield>0){var s=Math.min(this._bossState.shield,e);this._bossState.shield-=s,e-=s,h.instance.emit(v.BOSS_SHIELD,{absorbed:s,remainingShield:this._bossState.shield})}e=Math.max(1,e-this._bossState.config.defense),t.element&&this._bossState.config.weakness===t.element&&(e=Math.floor(1.5*e)),t.element&&this._bossState.config.resistance===t.element&&(e=Math.floor(.5*e)),this._bossState.currentHp=Math.max(0,this._bossState.currentHp-e),h.instance.emit(v.BOSS_DAMAGED,{damage:e,currentHp:this._bossState.currentHp,maxHp:this._bossState.config.maxHp}),h.instance.emit(v.BOSS_HP_CHANGED,{currentHp:this._bossState.currentHp,maxHp:this._bossState.config.maxHp,percent:this.hpPercent}),this._bossState.currentHp<=0&&(this._bossState.defeated=!0,h.instance.emit(v.BOSS_DEFEATED,this._bossState.config),h.instance.emit("BOSS_DEFEATED"),console.log('Boss "'+this._bossState.config.name+'" defeated!'))}},r.onTurnEnd=function(t){if(this._bossState&&!this._bossState.defeated){this._bossState.turnCount++;for(var e=0;e<this._bossState.skillCooldowns.length;e++)this._bossState.skillCooldowns[e]>0&&this._bossState.skillCooldowns[e]--;this.executeBossAI(),h.instance.emit(v.BOSS_TURN,{turnCount:this._bossState.turnCount,bossState:this._bossState})}},r.executeBossAI=function(){if(this._bossState){for(var t=this._bossState,e=[],s=0;s<t.config.skills.length;s++)t.skillCooldowns[s]<=0&&e.push({index:s,skill:t.config.skills[s]});if(0!==e.length){var o,i=e.find((function(t){return t.skill.type===d.Heal}));o=i&&this.hpPercent<.3?i:e[Math.floor(Math.random()*e.length)],this.executeSkill(o.index,o.skill)}}},r.executeSkill=function(t,e){if(this._bossState)switch(this._bossState.skillCooldowns[t]=e.cooldown,console.log("Boss uses: "+e.name),h.instance.emit(v.BOSS_SKILL,e),e.type){case d.Petrify:this.skillPetrify(e.params.count||3);break;case d.LockGems:this.skillLockGems(e.params.count||4);break;case d.PoisonSpread:this.skillPoisonSpread(e.params.count||2);break;case d.ReduceMoves:this.skillReduceMoves(e.params.amount||2);break;case d.Shield:this.skillShield(e.params.amount||50);break;case d.ColorShift:this.skillColorShift(e.params.count||5);break;case d.Heal:this.skillHeal(e.params.amount||100)}},r.skillPetrify=function(t){for(var e,s=this.getRandomBoardPositions(t),o=a(s);!(e=o()).done;){var i=e.value,n=this.boardManager.getGemAt(i.row,i.col);n&&(n.locked=!0)}h.instance.emit("BOSS_SKILL_EFFECT",{type:d.Petrify,positions:s})},r.skillLockGems=function(t){for(var e,s=this.getRandomBoardPositions(t),o=a(s);!(e=o()).done;){var i=e.value,n=this.boardManager.getGemAt(i.row,i.col);n&&(n.locked=!0)}h.instance.emit("BOSS_SKILL_EFFECT",{type:d.LockGems,positions:s})},r.skillPoisonSpread=function(t){for(var e,s=this.getRandomBoardPositions(t),o=a(s);!(e=o()).done;){var i=e.value,n=this.boardManager.getGemAt(i.row,i.col);n&&(n.poisoned=!0)}h.instance.emit("BOSS_SKILL_EFFECT",{type:d.PoisonSpread,positions:s})},r.skillReduceMoves=function(t){var e=this.boardManager.movesLeft;this.boardManager.setMoves(Math.max(1,e-t)),h.instance.emit("BOSS_SKILL_EFFECT",{type:d.ReduceMoves,amount:t})},r.skillShield=function(t){this._bossState&&(this._bossState.shield+=t,h.instance.emit("BOSS_SKILL_EFFECT",{type:d.Shield,shieldAmount:t,totalShield:this._bossState.shield}))},r.skillColorShift=function(t){for(var e,s=this.getRandomBoardPositions(t),o=a(s);!(e=o()).done;){var i=e.value,n=this.boardManager.getGemAt(i.row,i.col);if(n){var r=Math.floor(Math.random()*this.boardManager.config.gemTypes);n.color=r}}h.instance.emit("BOSS_SKILL_EFFECT",{type:d.ColorShift,positions:s})},r.skillHeal=function(t){if(this._bossState){var e=this._bossState.currentHp;this._bossState.currentHp=Math.min(this._bossState.config.maxHp,this._bossState.currentHp+t);var s=this._bossState.currentHp-e;h.instance.emit(v.BOSS_HP_CHANGED,{currentHp:this._bossState.currentHp,maxHp:this._bossState.config.maxHp,percent:this.hpPercent}),h.instance.emit("BOSS_SKILL_EFFECT",{type:d.Heal,healed:s})}},r.getRandomBoardPositions=function(t){for(var e=[],s=this.boardManager.boardData,o=[],i=0;i<s.length;i++)for(var a=0;a<((null==(n=s[i])?void 0:n.length)||0);a++){var n;s[i][a]&&!s[i][a].locked&&o.push({row:i,col:a})}for(var r=o.length-1;r>0&&e.length<t;r--){var l=Math.floor(Math.random()*(r+1)),c=[o[l],o[r]];o[r]=c[0],o[l]=c[1],e.push(o[r])}return e.slice(0,t)},n(e,[{key:"bossState",get:function(){return this._bossState}},{key:"isAlive",get:function(){return!!this._bossState&&!this._bossState.defeated}},{key:"hpPercent",get:function(){return this._bossState?this._bossState.currentHp/this._bossState.config.maxHp:0}}]),e}(c)).prototype,"boardManager",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=p))||b));r._RF.pop()}}}));

System.register("bundle://main/_virtual/DamageCalculator.ts",["cc","./GameTypes.ts"],(function(e){var a,t,l;return{setters:[function(e){a=e.cclegacy},function(e){t=e.getElementMultiplier,l=e.SpecialType}],execute:function(){a._RF.push({},"971e88l5y5ONLBPdCIQgcd7","DamageCalculator",void 0);e("DamageCalculator",function(){function e(){}return e.calculateDamage=function(e,a,l,r){var c=10*e.count,n=1+.25*(a-1),i=t(e.element,r.element),u=Math.random()<l.critRate,o=u?2:1;return{baseDamage:c,comboMultiplier:n,elementMultiplier:i,critMultiplier:o,totalDamage:Math.floor(c*n*i*o*l.atkBonus),element:e.element,isCrit:u}},e.calculateSpecialDamage=function(e,a,t){var r=0;switch(e){case l.Lightning:r=8;break;case l.Bomb:r=12;break;case l.Star:r=6;break;case l.BlackHole:r=15;break;default:return 0}var c=1+.1*(t-1);return Math.floor(a*r*c)},e}());a._RF.pop()}}}));

System.register("bundle://main/_virtual/EventCenter.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,s;return{setters:[function(e){t=e.createClass},function(e){n=e.cclegacy,s=e._decorator}],execute:function(){var E,r;n._RF.push({},"52d6e4mF5NPn4VmP6V2B+6b","EventCenter",void 0);var i=s.ccclass;s.property,e("GAME_EVENTS",function(e){return e.GEM_SWAPPED="GEM_SWAPPED",e.MATCH_FOUND="MATCH_FOUND",e.GEM_ELIMINATED="GEM_ELIMINATED",e.FALL_COMPLETE="FALL_COMPLETE",e.COMBO_TRIGGERED="COMBO_TRIGGERED",e.SPECIAL_ACTIVATED="SPECIAL_ACTIVATED",e.DAMAGE_DEALT="DAMAGE_DEALT",e.LEVEL_COMPLETE="LEVEL_COMPLETE",e.LEVEL_FAILED="LEVEL_FAILED",e.SCORE_CHANGED="SCORE_CHANGED",e.BOSS_DAMAGED="BOSS_DAMAGED",e.BOSS_SKILL_TRIGGERED="BOSS_SKILL_TRIGGERED",e.ENEMY_DEFEATED="ENEMY_DEFEATED",e}({})),e("EventCenter",i("EventCenter")(((r=function(){function e(){this._listeners=new Map}var n=e.prototype;return n.on=function(e,t,n){this._listeners.has(e)||this._listeners.set(e,[]),this._listeners.get(e).push({callback:t,target:n,once:!1})},n.once=function(e,t,n){this._listeners.has(e)||this._listeners.set(e,[]),this._listeners.get(e).push({callback:t,target:n,once:!0})},n.off=function(e,t,n){if(this._listeners.has(e))for(var s=this._listeners.get(e),E=s.length-1;E>=0;E--){var r=s[E];r.callback!==t||n&&r.target!==n||s.splice(E,1)}},n.emit=function(e){if(this._listeners.has(e)){for(var t=this._listeners.get(e),n=arguments.length,s=new Array(n>1?n-1:0),E=1;E<n;E++)s[E-1]=arguments[E];for(var r=t.length-1;r>=0;r--){var i=t[r];i&&(i.callback.apply(i.target,s),i.once&&t.splice(r,1))}}},n.targetOff=function(e){this._listeners.forEach((function(t,n){for(var s=t.length-1;s>=0;s--)t[s].target===e&&t.splice(s,1)}))},n.clear=function(){this._listeners.clear()},t(e,null,[{key:"instance",get:function(){return this._instance||(this._instance=new e),this._instance}}]),e}())._instance=void 0,E=r))||E);n._RF.pop()}}}));

System.register("bundle://main/_virtual/FallEngine.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameTypes.ts","./MatchEngine.ts"],(function(o){var r,e,l,n,a;return{setters:[function(o){r=o.createForOfIteratorHelperLoose},function(o){e=o.cclegacy},function(o){l=o.GemColor,n=o.SpecialType},function(o){a=o.MatchEngine}],execute:function(){e._RF.push({},"add6b1uRvNB4ZlzGyVbPqqn","FallEngine",void 0);o("FallEngine",function(){function o(){}return o.calculateFalls=function(o,r){void 0===r&&(r="down");var e=o.length,n=o[0].length,a=[];if("down"!==r)return console.warn("FallEngine: Only down gravity is supported for now."),[];for(var t=0;t<n;t++){for(var i=0,c=e-1;c>=0;c--){var u=o[c][t];if(null===u||u.color===l.None)i++;else if(i>0){var s=c+i;a.push({fromRow:c,fromCol:t,toRow:s,toCol:t,isNew:!1}),o[s][t]=u,o[s][t].row=s,o[c][t]=null}}for(var f=0;f<i;f++)a.push({fromRow:-1-f,fromCol:t,toRow:f,toCol:t,isNew:!0})}return a},o.generateNewGems=function(o,e,l){for(var a,t=[],i=r(e);!(a=i()).done;){var c=a.value,u=void 0,s=0;do{u=Math.floor(Math.random()*l.gemTypes),s++}while(this.willCauseMatch(o,c.row,c.col,u)&&s<10);var f={color:u,special:n.Normal,row:c.row,col:c.col,hp:0,locked:!1,poisoned:!1,hidden:!1};o[c.row][c.col]=f,t.push(f)}return t},o.willCauseMatch=function(o,r,e,l){var n=o.length,a=o[0].length;if(e>=2){var t=o[r][e-1],i=o[r][e-2];if(t&&t.color===l&&i&&i.color===l)return!0}if(e<=a-3){var c=o[r][e+1],u=o[r][e+2];if(c&&c.color===l&&u&&u.color===l)return!0}if(r<=n-3){var s=o[r+1][e],f=o[r+2][e];if(s&&s.color===l&&f&&f.color===l)return!0}if(r>=2){var v=o[r-1][e],h=o[r-2][e];if(v&&v.color===l&&h&&h.color===l)return!0}return!1},o.processChainReaction=function(o,e){for(var l=0,n=[],t=[],i=!0;i&&l<20;){var c=a.findAllMatches(o);if(c.length>0){l++,t.push.apply(t,c);for(var u,s=r(c);!(u=s()).done;)for(var f,v=u.value,h=r(v.gems);!(f=h()).done;){var p=f.value;o[p.row][p.col]=null}var w=this.calculateFalls(o,e.gravity);n.push.apply(n,w);for(var d=[],g=0;g<o.length;g++)for(var m=0;m<o[0].length;m++)o[g][m]||d.push({row:g,col:m});this.generateNewGems(o,d,e)}else i=!1}return{falls:n,matches:t,rounds:l}},o}());e._RF.pop()}}}));

System.register("bundle://main/_virtual/GameBackground.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,o,a,n,r,i,s,l,d,c,u,p,m,g,h,f,v,w;return{setters:[function(e){t=e.inheritsLoose},function(e){o=e.cclegacy,a=e._decorator,n=e.view,r=e.UITransform,i=e.Sprite,s=e.Color,l=e.resources,d=e.SpriteFrame,c=e.Texture2D,u=e.ImageAsset,p=e.Node,m=e.Layers,g=e.Graphics,h=e.UIOpacity,f=e.tween,v=e.Component,w=e.Vec3}],execute:function(){var y;o._RF.push({},"43260+NFplPz55QzbPg4xnn","GameBackground",void 0);var _=a.ccclass;a.property,e("GameBackground",_("GameBackground")(y=function(e){function o(){for(var t,o=arguments.length,a=new Array(o),n=0;n<o;n++)a[n]=arguments[n];return(t=e.call.apply(e,[this].concat(a))||this)._sprite=null,t}t(o,e);var a=o.prototype;return a.onLoad=function(){var e=n.getVisibleSize(),t=e.width,o=e.height,a=this.node.getComponent(r)||this.node.addComponent(r);a.setContentSize(t,o),a.setAnchorPoint(.5,.5),this._sprite=this.node.addComponent(i),this._sprite.type=i.Type.SIMPLE,this._sprite.sizeMode=i.SizeMode.CUSTOM,this._sprite.color=new s(255,255,255,255),this.loadBackgroundImage(),this.spawnFloatingParticles(t,o)},a.loadBackgroundImage=function(){var e=this;l.load("images/bg_bytedance/spriteFrame",d,(function(t,o){if(!t&&o)return e._sprite.spriteFrame=o,void console.log("[GameBackground] Background loaded via SpriteFrame");l.load("images/bg_bytedance/texture",c,(function(t,o){if(!t&&o){var a=new d;return a.texture=o,e._sprite.spriteFrame=a,void console.log("[GameBackground] Background loaded via Texture2D")}l.load("images/bg_bytedance",u,(function(t,o){if(!t&&o){var a=new c;a.image=o;var n=new d;return n.texture=a,e._sprite.spriteFrame=n,void console.log("[GameBackground] Background loaded via ImageAsset")}console.warn("[GameBackground] All load methods failed, using fallback blue"),e._sprite.color=new s(30,60,180,255)}))}))}))},a.spawnFloatingParticles=function(e,t){for(var o=this,a=[new s(255,200,255,60),new s(200,220,255,50),new s(255,255,200,45),new s(220,200,255,55)],n=function(){var n=new p("BgParticle_"+i);n.layer=m.Enum.UI_2D;var l=6+14*Math.random(),d=n.addComponent(g);n.getComponent(r).setContentSize(4*l,4*l);var c=a[Math.floor(Math.random()*a.length)];d.fillColor=new s(c.r,c.g,c.b,Math.floor(.4*c.a)),d.circle(0,0,1.8*l),d.fill(),d.fillColor=c,d.circle(0,0,l),d.fill();var u=(Math.random()-.5)*e,v=(Math.random()-.5)*t;n.setPosition(u,v,0),n.addComponent(h).opacity=0,o.node.addChild(n);f(n).delay(5*Math.random()).call((function o(){var a=(Math.random()-.5)*e,r=(Math.random()-.5)*t,i=8+12*Math.random(),s=n.getComponent(h);f(s).to(2,{opacity:40+60*Math.random()}).delay(i-4).to(2,{opacity:0}).start(),f(n).to(i,{position:new w(a,r,0)}).call(o).start()})).start()},i=0;i<12;i++)n()},o}(v))||y);o._RF.pop()}}}));

System.register("bundle://main/_virtual/GameController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BoardManager.ts","./EventCenter.ts","./LevelTypes.ts","./GameTypes.ts","./GameOverPopup.ts","./GameBackground.ts","./AudioManager.ts","./LevelConfigs.ts","./LevelManager.ts"],(function(e){var t,s,a,o,n,r,i,l,c,h,u,d,g,v,m,_,L,p,f,C;return{setters:[function(e){t=e.inheritsLoose,s=e.extends,a=e.createForOfIteratorHelperLoose,o=e.createClass},function(e){n=e.cclegacy,r=e._decorator,i=e.director,l=e.Node,c=e.Component},function(e){h=e.BoardManager},function(e){u=e.EventCenter,d=e.GAME_EVENTS},function(e){g=e.LevelGoalType},function(e){v=e.SpecialType},function(e){m=e.GameOverPopup,_=e.POPUP_EVENTS},function(e){L=e.GameBackground},function(e){p=e.AudioManager},function(e){f=e.getLevelConfig},function(e){C=e.LEVEL_EVENTS}],execute:function(){var b;n._RF.push({},"b3eebDnLWdCpZXssZHURb6+","GameController",void 0);var M=r.ccclass;r.property,e("GameController",M("GameController")(b=function(e){function n(){for(var t,s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))||this)._boardManager=null,t._currentLevel=1,t._gameState="idle",t._goals=[],t._hasBoss=!1,t._bossHP=0,t._bossMaxHP=0,t._bossName="",t._bossDefense=0,t._starThresholds=null,t}t(n,e);var r=n.prototype;return r.onLoad=function(){var e,t=null==(e=i.getScene())?void 0:e.getChildByName("Canvas"),s=null==t?void 0:t.getChildByName("BoardNode");if(s&&(this._boardManager=s.getComponent(h)),this._boardManager){if(t&&!t.getChildByName("Background")){var a=new l("Background");a.addComponent(L),t.insertChild(a,0),console.log("[GameController] Background node created dynamically")}if(t&&!t.getChildByName("PopupLayer")){var o=new l("PopupLayer");o.addComponent(m),t.addChild(o),console.log("[GameController] PopupLayer node created dynamically")}if(t&&!t.getChildByName("AudioManager")){var n=new l("AudioManager");n.addComponent(p),t.addChild(n),console.log("[GameController] AudioManager node created dynamically")}u.instance.on(d.DAMAGE_DEALT,this.onDamageDealt,this),u.instance.on(d.SCORE_CHANGED,this.onScoreChanged,this),u.instance.on(d.MATCH_FOUND,this.onMatchFound,this),u.instance.on("TURN_COMPLETE",this.onTurnComplete,this),u.instance.on(_.RESTART_LEVEL,this.onRestartLevel,this),u.instance.on(_.NEXT_LEVEL,this.onNextLevel,this)}else console.error("[GameController] BoardManager not found! Make sure BoardNode exists under Canvas.")},r.start=function(){this._boardManager&&this.startLevel(1)},r.onDestroy=function(){u.instance.targetOff(this)},r.startLevel=function(e){console.log("[GameController] Starting level "+e),this._currentLevel=e,this._gameState="playing";var t=f(e);t?this.setupLevel(t):(console.warn("[GameController] No config for level "+e+", using defaults"),this.setupLevelFromDefaults(e))},r.setupLevel=function(e){var t;this._boardManager.reset();var a=e.rows||9,o=e.cols||7,n=e.gemTypes||6,r=e.maxMoves||30;this._boardManager.setGemTypes(n),this._boardManager.setMoves(r);var i=null==(t=e.boardPreset)?void 0:t.obstacles;this._boardManager.initBoard({rows:a,cols:o,gemTypes:n},i),this._goals=(e.goals||[]).map((function(e){return s({},e,{current:0})})),this._starThresholds=e.starThresholds||null,this._hasBoss=!!e.boss,e.boss&&(this._bossHP=e.boss.maxHp,this._bossMaxHP=e.boss.maxHp,this._bossName=e.boss.name,this._bossDefense=e.boss.defense||0),this.emitLevelStart(e.id,e.name||"æ·±æµ·æ¶ˆæ¶ˆä¹",r),console.log("[GameController] Level "+e.id+" loaded â€” "+a+"x"+o+", "+r+" moves")},r.setupLevelFromDefaults=function(e){this._boardManager.reset();var t=Math.min(4+Math.floor(e/10),8);this._boardManager.setGemTypes(t),this._boardManager.setMoves(30),this._boardManager.initBoard({rows:9,cols:7,gemTypes:t}),this._goals=[{type:g.Score,target:3e3+500*e,current:0}],this._hasBoss=!1,this.emitLevelStart(e,"æ·±æµ·æ¶ˆæ¶ˆä¹",30)},r.emitLevelStart=function(e,t,s){u.instance.emit("LEVEL_START",{levelId:e,levelName:t,moves:s,goals:this._goals,hasBoss:this._hasBoss,bossName:this._bossName,bossHP:this._bossMaxHP})},r.onDamageDealt=function(e){if("playing"===this._gameState&&this._hasBoss){var t=Math.max(1,e.totalDamage-this._bossDefense);this._bossHP=Math.max(0,this._bossHP-t),u.instance.emit(d.BOSS_DAMAGED,{currentHP:this._bossHP,maxHP:this._bossMaxHP,damage:t}),this._bossHP<=0&&(u.instance.emit(d.ENEMY_DEFEATED),this.completeLevelSuccess())}},r.onMatchFound=function(e){if("playing"===this._gameState)for(var t,s=a(e);!(t=s()).done;){var o=t.value;this.updateGoalProgress(g.CollectColor,o.count||0,o.color),o.specialToCreate&&o.specialToCreate!==v.Normal&&this.updateGoalProgress(g.CollectSpecial,1,void 0,o.specialToCreate)}},r.onScoreChanged=function(e){"playing"===this._gameState&&this.updateGoalProgress(g.Score,e.score,void 0,void 0,!0)},r.onTurnComplete=function(e){var t=this;"playing"===this._gameState&&e.movesLeft<=0&&this.scheduleOnce((function(){return t.checkLevelEnd()}),.5)},r.updateGoalProgress=function(e,t,s,o,n){void 0===n&&(n=!1);for(var r,i=a(this._goals);!(r=i()).done;){var l=r.value;l.type===e&&(e===g.CollectColor&&l.color!==s||e===g.CollectSpecial&&l.specialType!==o||(l.current=n?t:l.current+t,u.instance.emit(C.GOAL_PROGRESS,l)))}u.instance.emit("GOALS_UPDATE",this._goals)},r.checkLevelEnd=function(){"playing"===this._gameState&&(this._goals.every((function(e){return e.current>=e.target}))?this.completeLevelSuccess():this._boardManager.movesLeft<=0&&this.completeLevelFailed())},r.completeLevelSuccess=function(){if("playing"===this._gameState){this._gameState="result";var e=this._boardManager.score,t=1;this._starThresholds?e>=this._starThresholds.threeStar?t=3:e>=this._starThresholds.twoStar&&(t=2):t=e>=1e4?3:e>=5e3?2:1,console.log("ðŸŽ‰ Level "+this._currentLevel+" CLEAR! Score: "+e+", Stars: "+t),u.instance.emit(d.LEVEL_COMPLETE,{levelId:this._currentLevel,score:e,stars:t})}},r.completeLevelFailed=function(){"playing"===this._gameState&&(this._gameState="result",console.log("ðŸ’€ Level "+this._currentLevel+" FAILED! Score: "+this._boardManager.score),u.instance.emit(d.LEVEL_FAILED,{levelId:this._currentLevel,score:this._boardManager.score,reason:"no_moves"}))},r.restartLevel=function(){this.startLevel(this._currentLevel)},r.nextLevel=function(){this.startLevel(this._currentLevel+1)},r.onRestartLevel=function(){this.restartLevel()},r.onNextLevel=function(){this.nextLevel()},o(n,[{key:"currentLevel",get:function(){return this._currentLevel}},{key:"gameState",get:function(){return this._gameState}},{key:"boardManager",get:function(){return this._boardManager}}]),n}(c))||b);n._RF.pop()}}}));

System.register("bundle://main/_virtual/GameOverPopup.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventCenter.ts"],(function(e){var t,n,o,i,l,a,s,r,h,d,c,_,p,u,v,L;return{setters:[function(e){t=e.inheritsLoose,n=e.createForOfIteratorHelperLoose},function(e){o=e.cclegacy,i=e._decorator,l=e.view,a=e.Node,s=e.UIOpacity,r=e.Graphics,h=e.UITransform,d=e.Color,c=e.Label,_=e.tween,p=e.Vec3,u=e.Component},function(e){v=e.EventCenter,L=e.GAME_EVENTS}],execute:function(){var C;o._RF.push({},"dae2fehOcJPLqPzDNwEhSKY","GameOverPopup",void 0);var f=i.ccclass,w=(i.property,e("POPUP_EVENTS",function(e){return e.RESTART_LEVEL="RESTART_LEVEL",e.NEXT_LEVEL="NEXT_LEVEL",e}({})));e("GameOverPopup",f("GameOverPopup")(C=function(e){function o(){for(var t,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(t=e.call.apply(e,[this].concat(o))||this)._overlayNode=null,t._panelNode=null,t._titleLabel=null,t._scoreLabel=null,t._starNodes=[],t._restartBtn=null,t._nextBtn=null,t._isShowing=!1,t}t(o,e);var i=o.prototype;return i.onLoad=function(){this.node.active=!1,this.buildUI(),v.instance.on(L.LEVEL_COMPLETE,this.onLevelComplete,this),v.instance.on(L.LEVEL_FAILED,this.onLevelFailed,this)},i.onDestroy=function(){v.instance.off(L.LEVEL_COMPLETE,this.onLevelComplete,this),v.instance.off(L.LEVEL_FAILED,this.onLevelFailed,this)},i.buildUI=function(){var e=l.getVisibleSize();this._overlayNode=new a("Overlay"),this._overlayNode.addComponent(s).opacity=0;var t=this._overlayNode.addComponent(r);this._overlayNode.getComponent(h).setContentSize(e.width,e.height),t.fillColor=new d(0,0,0,180),t.rect(-e.width/2,-e.height/2,e.width,e.height),t.fill(),this.node.addChild(this._overlayNode),this._panelNode=new a("Panel");this._panelNode.addComponent(s).opacity=0,this._panelNode.setScale(.5,.5,1);var n=this._panelNode.addComponent(r);this._panelNode.getComponent(h).setContentSize(440,400),this.drawPanel(n,440,400),this.node.addChild(this._panelNode);var o=new a("Title");o.setPosition(0,130,0),this._titleLabel=o.addComponent(c),this._titleLabel.string="",this._titleLabel.fontSize=42,this._titleLabel.lineHeight=50,this._titleLabel.color=new d(255,255,255),this._titleLabel.isBold=!0,o.getComponent(h).setContentSize(400,60),this._panelNode.addChild(o);var i=new a("Score");i.setPosition(0,50,0),this._scoreLabel=i.addComponent(c),this._scoreLabel.string="",this._scoreLabel.fontSize=60,this._scoreLabel.lineHeight=70,this._scoreLabel.color=new d(255,220,100),this._scoreLabel.isBold=!0,i.getComponent(h).setContentSize(400,80),this._panelNode.addChild(i);for(var _=0;_<3;_++){var p=new a("Star"+_),u=70*(_-1);p.setPosition(u,-20,0);var v=p.addComponent(c);v.string="â˜†",v.fontSize=50,v.lineHeight=60,v.color=new d(120,120,120),p.getComponent(h).setContentSize(60,60),p.setScale(0,0,1),this._panelNode.addChild(p),this._starNodes.push(p)}this._restartBtn=this.createButton("RestartBtn","å†æ¥ä¸€æ¬¡",-110,-130,new d(100,80,200),new d(130,110,230)),this._panelNode.addChild(this._restartBtn),this._nextBtn=this.createButton("NextBtn","ä¸‹ä¸€å…³",110,-130,new d(50,180,120),new d(80,210,150)),this._panelNode.addChild(this._nextBtn)},i.drawPanel=function(e,t,n){var o=t/2,i=n/2;e.fillColor=new d(100,80,220,30),this.roundRect(e,-o-8,-i-8,t+16,n+16,24),e.fill(),e.fillColor=new d(20,15,50,230),this.roundRect(e,-o,-i,t,n,20),e.fill(),e.strokeColor=new d(120,100,220,120),e.lineWidth=2,this.roundRect(e,4-o,4-i,t-8,n-8,18),e.stroke(),e.fillColor=new d(150,130,255,40),e.rect(20-o,i-6,t-40,3),e.fill()},i.createButton=function(e,t,n,o,i,l){var s=this,_=new a(e);_.setPosition(n,o,0);var p=160,u=_.addComponent(r);_.getComponent(h).setContentSize(p,52),u.fillColor=i,this.roundRect(u,-80,-26,p,52,12),u.fill(),u.fillColor=new d(255,255,255,25),u.rect(-76,0,152,22),u.fill();var L=new a("Label"),C=L.addComponent(c);return C.string=t,C.fontSize=26,C.lineHeight=30,C.color=new d(255,255,255),C.isBold=!0,L.getComponent(h).setContentSize(p,52),_.addChild(L),_.on(a.EventType.TOUCH_END,(function(){"RestartBtn"===e?(s.hide(),v.instance.emit(w.RESTART_LEVEL)):"NextBtn"===e&&(s.hide(),v.instance.emit(w.NEXT_LEVEL))}),this),_},i.roundRect=function(e,t,n,o,i,l){e.moveTo(t+l,n),e.lineTo(t+o-l,n),e.arc(t+o-l,n+l,l,-Math.PI/2,0,!1),e.lineTo(t+o,n+i-l),e.arc(t+o-l,n+i-l,l,0,Math.PI/2,!1),e.lineTo(t+l,n+i),e.arc(t+l,n+i-l,l,Math.PI/2,Math.PI,!1),e.lineTo(t,n+l),e.arc(t+l,n+l,l,Math.PI,1.5*Math.PI,!1),e.close()},i.onLevelComplete=function(e){var t=(null==e?void 0:e.stars)||1,n=(null==e?void 0:e.score)||0;this.show(!0,n,t)},i.onLevelFailed=function(e){var t=(null==e?void 0:e.score)||0;this.show(!1,t,0)},i.show=function(e,t,o){var i=this;if(!this._isShowing){this._isShowing=!0,this.node.active=!0,e?(this._titleLabel.string="âœ¨ å…³å¡é€šè¿‡! âœ¨",this._titleLabel.color=new d(255,215,80),this._titleLabel.enableOutline=!0,this._titleLabel.outlineColor=new d(180,120,0,200),this._titleLabel.outlineWidth=3):(this._titleLabel.string="ðŸ’” æŒ‘æˆ˜å¤±è´¥",this._titleLabel.color=new d(231,100,100),this._titleLabel.enableOutline=!0,this._titleLabel.outlineColor=new d(120,30,30,200),this._titleLabel.outlineWidth=3),this._scoreLabel.string="ðŸ† "+t,this._nextBtn.active=e;for(var l,a=n(this._starNodes);!(l=a()).done;){var r=l.value;r.setScale(0,0,1),r.getComponent(c).string="â˜†",r.getComponent(c).color=new d(120,120,120)}var h=this._overlayNode.getComponent(s);h.opacity=0,_(h).to(.3,{opacity:255}).start();var u=this._panelNode.getComponent(s);if(u.opacity=0,this._panelNode.setScale(.3,.3,1),_(this._panelNode).to(.2,{scale:new p(1.1,.85,1)},{easing:"backOut"}).to(.12,{scale:new p(.92,1.08,1)}).to(.08,{scale:new p(1.03,.97,1)}).to(.06,{scale:new p(1,1,1)}).start(),_(u).to(.2,{opacity:255}).start(),e&&o>0)for(var v=function(){var e=i._starNodes[L];_(e).delay(.6+.25*L).call((function(){e.getComponent(c).string="â˜…",e.getComponent(c).color=new d(255,215,0),e.getComponent(c).fontSize=52})).to(.15,{scale:new p(1.8,.7,1)},{easing:"backOut"}).to(.1,{scale:new p(.85,1.3,1)}).to(.08,{scale:new p(1.1,.95,1)}).to(.06,{scale:new p(1,1,1)}).start()},L=0;L<Math.min(o,3);L++)v()}},i.hide=function(){var e=this;if(this._isShowing){this._isShowing=!1;var t=this._panelNode.getComponent(s),n=this._overlayNode.getComponent(s);_(this._panelNode).to(.2,{scale:new p(.8,.8,1)},{easing:"backIn"}).start(),_(t).to(.2,{opacity:0}).start(),_(n).to(.25,{opacity:0}).call((function(){e.node.active=!1})).start()}},o}(u))||C);o._RF.pop()}}}));

System.register("bundle://main/_virtual/GameTypes.ts",["cc"],(function(e){var r;return{setters:[function(e){r=e.cclegacy}],execute:function(){var n;e({createGemData:function(e,r,n,i){void 0===i&&(i=t.Normal);return{color:e,special:i,row:r,col:n,hp:0,locked:!1,poisoned:!1,hidden:!1}},getElementMultiplier:function(e,r){return e===o.None||r===o.None?1:e===o.Fire&&r===o.Ice||e===o.Ice&&r===o.Thunder||e===o.Thunder&&r===o.Fire?1.5:e===o.Ice&&r===o.Fire||e===o.Thunder&&r===o.Ice||e===o.Fire&&r===o.Thunder?.75:e===o.Light&&r===o.Dark||e===o.Dark&&r===o.Light?2:e===r?.75:1}}),r._RF.push({},"a330fd1JldN2a0QyU1nrE1d","GameTypes",void 0);var i=e("GemColor",function(e){return e[e.Red=0]="Red",e[e.Orange=1]="Orange",e[e.Yellow=2]="Yellow",e[e.Green=3]="Green",e[e.Blue=4]="Blue",e[e.Purple=5]="Purple",e[e.Light=6]="Light",e[e.Dark=7]="Dark",e[e.None=8]="None",e}({})),t=e("SpecialType",function(e){return e[e.Normal=0]="Normal",e[e.Lightning=1]="Lightning",e[e.Bomb=2]="Bomb",e[e.Star=3]="Star",e[e.BlackHole=4]="BlackHole",e}({})),o=e("ElementType",function(e){return e[e.Fire=0]="Fire",e[e.Ice=1]="Ice",e[e.Thunder=2]="Thunder",e[e.Light=3]="Light",e[e.Dark=4]="Dark",e[e.None=5]="None",e}({}));e("COLOR_ELEMENT_MAP",((n={})[i.Red]=o.Fire,n[i.Orange]=o.Fire,n[i.Yellow]=o.Thunder,n[i.Green]=o.Ice,n[i.Blue]=o.Ice,n[i.Purple]=o.Dark,n[i.Light]=o.Light,n[i.Dark]=o.Dark,n[i.None]=o.None,n));r._RF.pop()}}}));

System.register("bundle://main/_virtual/GameUIView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventCenter.ts","./LevelTypes.ts"],(function(e){var o,t,s,l,a,n,i,r,h,c,b,d,_,L,v,m,u,w;return{setters:[function(e){o=e.inheritsLoose,t=e.createForOfIteratorHelperLoose},function(e){s=e.cclegacy,l=e._decorator,a=e.Color,n=e.Label,i=e.Vec2,r=e.tween,h=e.Vec3,c=e.Node,b=e.Layers,d=e.UITransform,_=e.Graphics,L=e.Tween,v=e.Component},function(e){m=e.EventCenter,u=e.GAME_EVENTS},function(e){w=e.LevelGoalType}],execute:function(){var g;s._RF.push({},"bc31apa3X9JZZTHLLav8X9s","GameUIView",void 0);var f=l.ccclass,C=(l.property,new a(70,220,255)),p=new a(15,60,120,255),S=new a(0,40,100,180),y=new a(255,215,80),B=new a(120,70,10,255),E=new a(180,120,0,150),O=new a(100,255,200),A=new a(10,80,60,255),G=new a(0,100,70,150),P=new a(255,80,80),T=new a(100,200,255),N=new a(160,120,255),I=new a(255,210,60),z=new a(255,80,40),H=new a(200,240,255),M=new a(100,255,160),D=new a(10,40,80,220),R=new a(10,30,70,160);e("GameUIView",f("GameUIView")(g=function(e){function s(){for(var o,t=arguments.length,s=new Array(t),l=0;l<t;l++)s[l]=arguments[l];return(o=e.call.apply(e,[this].concat(s))||this)._scoreLabel=null,o._movesLabel=null,o._levelLabel=null,o._comboLabel=null,o._maxBossHP=0,o._currentBossHP=0,o._hasBoss=!1,o._displayedScore=0,o._isLowMovesFlashing=!1,o._goalNodes=[],o._goalLabels=[],o}o(s,e);var l=s.prototype;return l.onLoad=function(){var e,o,t,s;this._scoreLabel=(null==(e=this.node.getChildByName("ScoreLabel"))?void 0:e.getComponent(n))||null,this._movesLabel=(null==(o=this.node.getChildByName("MovesLabel"))?void 0:o.getComponent(n))||null,this._levelLabel=(null==(t=this.node.getChildByName("LevelLabel"))?void 0:t.getComponent(n))||null,this._comboLabel=(null==(s=this.node.getChildByName("ComboLabel"))?void 0:s.getComponent(n))||null,console.log("[GameUIView] Labels found: score="+!!this._scoreLabel+", moves="+!!this._movesLabel+", level="+!!this._levelLabel+", combo="+!!this._comboLabel),m.instance.on(u.SCORE_CHANGED,this.onScoreChanged,this),m.instance.on(u.COMBO_TRIGGERED,this.onComboTriggered,this),m.instance.on(u.BOSS_DAMAGED,this.onBossDamaged,this),m.instance.on("LEVEL_START",this.onLevelStart,this),m.instance.on("GOALS_UPDATE",this.onGoalsUpdate,this),this._comboLabel&&(this._comboLabel.node.active=!1)},l.onDestroy=function(){m.instance.targetOff(this)},l.onLevelStart=function(e){this._levelLabel&&(this._levelLabel.string="ðŸš æ·±æµ·æ¶ˆæ¶ˆä¹ ðŸš",this._levelLabel.fontSize=38,this._levelLabel.isBold=!0,this._levelLabel.color=C,this._levelLabel.enableOutline=!0,this._levelLabel.outlineColor=p,this._levelLabel.outlineWidth=4,this._levelLabel.enableShadow=!0,this._levelLabel.shadowColor=S,this._levelLabel.shadowOffset=new i(2,-3),this._levelLabel.shadowBlur=10,this._levelLabel.node.setScale(0,0,1),r(this._levelLabel.node).to(.35,{scale:new h(1.08,.94,1)},{easing:"backOut"}).to(.12,{scale:new h(.97,1.05,1)}).to(.08,{scale:new h(1,1,1)}).start()),this._scoreLabel&&(this._scoreLabel.string="ðŸª™ 0",this._displayedScore=0,this._scoreLabel.fontSize=36,this._scoreLabel.isBold=!0,this._scoreLabel.color=y,this._scoreLabel.enableOutline=!0,this._scoreLabel.outlineColor=B,this._scoreLabel.outlineWidth=3,this._scoreLabel.enableShadow=!0,this._scoreLabel.shadowColor=E,this._scoreLabel.shadowOffset=new i(2,-2),this._scoreLabel.shadowBlur=6,this._scoreLabel.node.setScale(0,0,1),r(this._scoreLabel.node).delay(.15).to(.25,{scale:new h(1.08,.94,1)},{easing:"backOut"}).to(.1,{scale:new h(.97,1.04,1)}).to(.06,{scale:new h(1,1,1)}).start()),this._movesLabel&&(this._movesLabel.string="ðŸ«§ "+e.moves,this._isLowMovesFlashing=!1,this._movesLabel.fontSize=36,this._movesLabel.isBold=!0,this._movesLabel.color=O,this._movesLabel.enableOutline=!0,this._movesLabel.outlineColor=A,this._movesLabel.outlineWidth=3,this._movesLabel.enableShadow=!0,this._movesLabel.shadowColor=G,this._movesLabel.shadowOffset=new i(2,-2),this._movesLabel.shadowBlur=6,this._movesLabel.node.setScale(0,0,1),r(this._movesLabel.node).delay(.25).to(.25,{scale:new h(1.08,.94,1)},{easing:"backOut"}).to(.1,{scale:new h(.97,1.04,1)}).to(.06,{scale:new h(1,1,1)}).start()),this._hasBoss=e.hasBoss,e.hasBoss&&(this._maxBossHP=e.bossHP,this._currentBossHP=e.bossHP),this._comboLabel&&(this._comboLabel.node.active=!1),this.createGoalPanel(e.goals||[])},l.createGoalPanel=function(e){for(var o,s=this,l=t(this._goalNodes);!(o=l()).done;){o.value.destroy()}this._goalNodes=[],this._goalLabels=[];var L=this.node.getChildByName("GoalPanel");L?L.removeAllChildren():((L=new c("GoalPanel")).layer=b.Enum.UI_2D,L.addComponent(d).setContentSize(500,50),this.node.addChild(L));var v=this.node.getChildByName("LevelLabel");if(v){var m=v.position.y;L.setPosition(0,m-50,0)}else L.setPosition(0,280,0);if(0!==e.length){var u=L.getComponent(_)||L.addComponent(_),w=150*e.length+10*(e.length-1)+30;u.clear(),u.fillColor=R,u.roundRect(-w/2,-22,w,44,12),u.fill(),u.strokeColor=new a(80,180,255,100),u.lineWidth=1.5,u.roundRect(-w/2,-22,w,44,12),u.stroke();var g=150*-(e.length-1)/2;e.forEach((function(e,o){var t=new c("Goal_"+o);t.layer=b.Enum.UI_2D,t.addComponent(d).setContentSize(140,40),t.setPosition(g+150*o,0,0);var l=new c("Icon");l.layer=b.Enum.UI_2D,l.addComponent(d).setContentSize(36,36),l.setPosition(-50,0,0);var _=l.addComponent(n);_.string=s.getGoalIcon(e),_.fontSize=24,_.horizontalAlign=n.HorizontalAlign.CENTER,_.verticalAlign=n.VerticalAlign.CENTER,t.addChild(l);var v=new c("Text");v.layer=b.Enum.UI_2D,v.addComponent(d).setContentSize(90,36),v.setPosition(10,0,0);var m=v.addComponent(n);m.string=e.current+"/"+e.target,m.fontSize=20,m.isBold=!0,m.color=H,m.horizontalAlign=n.HorizontalAlign.LEFT,m.verticalAlign=n.VerticalAlign.CENTER,m.enableOutline=!0,m.outlineColor=D,m.outlineWidth=2,m.enableShadow=!0,m.shadowColor=new a(0,100,180,120),m.shadowOffset=new i(1,-1),m.shadowBlur=4,t.addChild(v),L.addChild(t),s._goalNodes.push(t),s._goalLabels.push(m),t.setScale(0,0,1),r(t).delay(.5+.1*o).to(.2,{scale:new h(1.1,1.1,1)},{easing:"backOut"}).to(.08,{scale:new h(1,1,1)}).start()}))}},l.getGoalIcon=function(e){var o;switch(e.type){case w.Score:return"ðŸŽ¯";case w.CollectColor:return{0:"ðŸ”´",1:"ðŸŸ ",2:"ðŸŸ¡",3:"ðŸŸ¢",4:"ðŸ”µ",5:"ðŸŸ£",6:"âšª",7:"âš«"}[null!=(o=e.color)?o:0]||"ðŸ’Ž";case w.ClearObstacles:return"â„ï¸";case w.DefeatBoss:return"ðŸ²";case w.CollectSpecial:return"â­";case w.Survive:return"â°";default:return"ðŸŽ¯"}},l.onGoalsUpdate=function(e){var o=this;e.forEach((function(e,t){if(!(t>=o._goalLabels.length)){var s=o._goalLabels[t],l=e.current>=e.target;if(s.string=l?"âœ… "+e.target+"/"+e.target:e.current+"/"+e.target,s.color=l?M:H,l&&o._goalNodes[t]){var a=o._goalNodes[t];r(a).to(.08,{scale:new h(1.25,1.25,1)}).to(.12,{scale:new h(1,1,1)},{easing:"backOut"}).start()}}}))},l.onScoreChanged=function(e){var o=this;if(this._scoreLabel){var t=e.score,s=this._displayedScore,l=Date.now(),n=setInterval((function(){var e=(Date.now()-l)/1e3,a=Math.min(e/.35,1),i=1-Math.pow(1-a,3),r=Math.round(s+(t-s)*i);o._displayedScore=r,o._scoreLabel&&(o._scoreLabel.string="ðŸª™ "+r),a>=1&&clearInterval(n)}),16);r(this._scoreLabel.node).to(.08,{scale:new h(1.12,1.12,1)}).to(.1,{scale:new h(1,1,1)}).start()}this._movesLabel&&(this._movesLabel.string="ðŸ«§ "+e.movesLeft,e.movesLeft<=5?(this._movesLabel.color=P,this._movesLabel.outlineColor=new a(100,0,0,255),L.stopAllByTarget(this._movesLabel.node),r(this._movesLabel.node).to(.06,{scale:new h(1.3,1.3,1)}).to(.1,{scale:new h(1,1,1)}).start(),this._isLowMovesFlashing||(this._isLowMovesFlashing=!0,r(this._movesLabel.node).delay(.2).to(.4,{scale:new h(1.08,1.08,1)}).to(.4,{scale:new h(.95,.95,1)}).union().repeatForever().start())):(this._movesLabel.color=O,this._movesLabel.outlineColor=A,this._isLowMovesFlashing=!1,L.stopAllByTarget(this._movesLabel.node),this._movesLabel.node.setScale(1,1,1)))},l.onComboTriggered=function(e){var o=this;if(this._comboLabel)if(e<=1)this._comboLabel.node.active=!1;else{this._comboLabel.node.active=!0,this._comboLabel.node.setRotationFromEuler(0,0,0);var t,s,l="COMBO x"+e,n=40,c=0;e>=8?(l="ðŸŒŠ TSUNAMI x"+e+" ðŸŒŠ",t=z,s=new a(80,0,0,240),n=54,c=12):e>=5?(l="ðŸ™ KRAKEN x"+e+" ðŸ™",t=I,s=new a(80,50,0,240),n=48,c=8):e>=3?(l="ðŸ  WAVE x"+e+" ðŸ ",t=N,s=new a(40,20,80,240),n=44,c=4):(t=T,s=new a(10,40,80,220),n=40,c=0),this._comboLabel.string=l,this._comboLabel.fontSize=n,this._comboLabel.color=t,this._comboLabel.isBold=!0,this._comboLabel.enableOutline=!0,this._comboLabel.outlineColor=s,this._comboLabel.outlineWidth=3,this._comboLabel.enableShadow=!0,this._comboLabel.shadowColor=new a(t.r,t.g,t.b,100),this._comboLabel.shadowOffset=new i(0,-2),this._comboLabel.shadowBlur=12,L.stopAllByTarget(this._comboLabel.node);var b=this._comboLabel.node;b.setScale(0,0,1),b.setRotationFromEuler(0,0,-6);var d=1+.05*e,_=Math.min(.85*d,1.5);if(r(b).to(.12,{scale:new h(d,d,1)},{easing:"backOut"}).to(.08,{scale:new h(.92*_,1.08*_,1)}).to(.06,{scale:new h(1.03*_,.97*_,1)}).to(.06,{scale:new h(_,_,1)}).call((function(){b.setRotationFromEuler(0,0,0)})).delay(1.2).to(.3,{scale:new h(.2,.2,1)},{easing:"backIn"}).call((function(){o._comboLabel&&(o._comboLabel.node.active=!1)})).start(),c>0){var v=this.node.parent;if(v){var m=v.getPosition().clone();L.stopAllByTarget(v),r(v).to(.03,{position:new h(m.x+c,m.y-.5*c,m.z)}).to(.03,{position:new h(m.x-.8*c,m.y+.7*c,m.z)}).to(.03,{position:new h(m.x+.5*c,m.y+.3*c,m.z)}).to(.03,{position:new h(m.x-.3*c,m.y-.5*c,m.z)}).to(.04,{position:m}).start()}}}},l.onBossDamaged=function(e){this._hasBoss&&(this._currentBossHP=e.currentHP,this._maxBossHP=e.maxHP)},s}(v))||g);s._RF.pop()}}}));

System.register("bundle://main/_virtual/LevelConfigs.ts",["cc","./GameTypes.ts","./LevelTypes.ts"],(function(e){var r,t,o,a,s;return{setters:[function(e){r=e.cclegacy},function(e){t=e.GemColor},function(e){o=e.LevelDifficulty,a=e.LevelGoalType,s=e.ObstacleType}],execute:function(){function l(e,r,t){return void 0===t&&(t=1),{type:s.Ice,hp:t,row:e,col:r,blocksFall:!1,vulnerableToSpecial:!0}}function c(e,r){return{type:s.Chain,hp:1,row:e,col:r,blocksFall:!1,vulnerableToSpecial:!0}}e("getLevelConfig",(function(e){return n.find((function(r){return r.id===e}))||null})),r._RF.push({},"c66d0ajTcVKAqIgeD+J+gSd","LevelConfigs",void 0);var n=e("ALL_LEVELS",[{id:1,name:"åˆå…¥æµ…æµ·",chapter:1,difficulty:o.Easy,rows:9,cols:7,gemTypes:5,maxMoves:30,goals:[{type:a.Score,target:1e3,current:0}],starThresholds:{oneStar:1e3,twoStar:1500,threeStar:2500},rewards:{coins:60,exp:15}},{id:2,name:"çŠç‘šèŠ±å›­",chapter:1,difficulty:o.Easy,rows:9,cols:7,gemTypes:5,maxMoves:25,goals:[{type:a.Score,target:1500,current:0}],starThresholds:{oneStar:1500,twoStar:2500,threeStar:4e3},rewards:{coins:70,exp:20}},{id:3,name:"æµ·æ˜Ÿä¹‹è·¯",chapter:1,difficulty:o.Easy,rows:9,cols:7,gemTypes:5,maxMoves:25,goals:[{type:a.CollectColor,target:15,current:0,color:t.Red}],starThresholds:{oneStar:1200,twoStar:2e3,threeStar:3500},rewards:{coins:70,exp:20}},{id:4,name:"æµ·é©¬ç‰§åœº",chapter:1,difficulty:o.Easy,rows:9,cols:7,gemTypes:5,maxMoves:22,goals:[{type:a.Score,target:2e3,current:0}],starThresholds:{oneStar:2e3,twoStar:3e3,threeStar:5e3},rewards:{coins:80,exp:25}},{id:5,name:"å½©è™¹æ°´åŸŸ",chapter:1,difficulty:o.Normal,rows:9,cols:7,gemTypes:6,maxMoves:25,goals:[{type:a.CollectColor,target:12,current:0,color:t.Blue},{type:a.CollectColor,target:12,current:0,color:t.Green}],starThresholds:{oneStar:2e3,twoStar:3e3,threeStar:5e3},rewards:{coins:90,exp:30}},{id:6,name:"å†°å°æµ·åŸŸ",chapter:1,difficulty:o.Normal,rows:9,cols:7,gemTypes:6,maxMoves:25,goals:[{type:a.ClearObstacles,target:4,current:0}],boardPreset:{obstacles:[l(2,3),l(4,2),l(4,4),l(6,3)]},starThresholds:{oneStar:2e3,twoStar:3500,threeStar:6e3},rewards:{coins:100,exp:35}},{id:7,name:"å¯’å†°è£‚éš™",chapter:1,difficulty:o.Normal,rows:9,cols:7,gemTypes:6,maxMoves:22,goals:[{type:a.Score,target:3e3,current:0},{type:a.ClearObstacles,target:6,current:0}],boardPreset:{obstacles:[l(1,2),l(1,4),l(3,1),l(3,5),l(5,2),l(5,4)]},starThresholds:{oneStar:3e3,twoStar:5e3,threeStar:8e3},rewards:{coins:110,exp:40}},{id:8,name:"é”é“¾æµ·åº•",chapter:1,difficulty:o.Normal,rows:9,cols:7,gemTypes:6,maxMoves:25,goals:[{type:a.CollectColor,target:20,current:0,color:t.Purple}],boardPreset:{obstacles:[c(2,3),c(4,2),c(4,4),c(6,3)]},starThresholds:{oneStar:2500,twoStar:4e3,threeStar:6500},rewards:{coins:120,exp:45}},{id:9,name:"å†°ä¸Žé”",chapter:1,difficulty:o.Hard,rows:9,cols:7,gemTypes:6,maxMoves:28,goals:[{type:a.ClearObstacles,target:8,current:0}],boardPreset:{obstacles:[l(1,1),l(1,5),l(3,3,2),l(5,1),l(5,5),c(2,2),c(2,4),c(6,3)]},starThresholds:{oneStar:3500,twoStar:5500,threeStar:8500},rewards:{coins:130,exp:50}},{id:10,name:"æ·±æµ·æ¼©æ¶¡",chapter:1,difficulty:o.Hard,rows:9,cols:7,gemTypes:6,maxMoves:22,goals:[{type:a.Score,target:5e3,current:0},{type:a.CollectColor,target:15,current:0,color:t.Yellow}],boardPreset:{obstacles:[l(0,3,2),l(2,1),l(2,5),c(4,2),c(4,4),l(6,1),l(6,5),l(8,3,2)]},starThresholds:{oneStar:5e3,twoStar:7500,threeStar:1e4},rewards:{coins:150,exp:60}}]);e("TOTAL_LEVELS",n.length),e("CHAPTERS",[{id:1,name:"æµ…æµ·çŠç‘šç¤",icon:"ðŸ ",levels:10}]);r._RF.pop()}}}));

System.register("bundle://main/_virtual/LevelManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventCenter.ts","./BoardManager.ts","./LevelTypes.ts","./GameTypes.ts"],(function(e){var t,r,s,o,n,l,a,i,c,v,u,d,h,L,g,p,f,E;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,s=e.initializerDefineProperty,o=e.assertThisInitialized,n=e.extends,l=e.createForOfIteratorHelperLoose,a=e.createClass},function(e){i=e.cclegacy,c=e._decorator,v=e.resources,u=e.JsonAsset,d=e.Component},function(e){h=e.EventCenter,L=e.GAME_EVENTS},function(e){g=e.BoardManager},function(e){p=e.LevelGoalType,f=e.LevelDifficulty},function(e){E=e.SpecialType}],execute:function(){var _,m,S,y,A;i._RF.push({},"77454jpHsVPyqv3G32Gf557","LevelManager",void 0);var M=c.ccclass,T=c.property,D=e("LEVEL_EVENTS",{LEVEL_LOADED:"level:loaded",LEVEL_START:"level:start",LEVEL_COMPLETE:"level:complete",LEVEL_FAILED:"level:failed",GOAL_PROGRESS:"level:goal_progress",STAR_EARNED:"level:star_earned"});e("LevelManager",(_=M("LevelManager"),m=T(g),_((A=t((y=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return t=e.call.apply(e,[this].concat(n))||this,s(t,"boardManager",A,o(t)),t._currentLevel=null,t._goals=[],t._levelProgress=new Map,t._isLevelActive=!1,t}r(t,e);var i=t.prototype;return i.onLoad=function(){h.instance.on(L.MATCH_FOUND,this.onMatchFound,this),h.instance.on(L.GEM_ELIMINATED,this.onGemEliminated,this),h.instance.on(L.SCORE_CHANGED,this.onScoreChanged,this),h.instance.on(L.SPECIAL_ACTIVATED,this.onSpecialActivated,this),h.instance.on("OBSTACLE_DESTROYED",this.onObstacleDestroyed,this),h.instance.on("BOSS_DEFEATED",this.onBossDefeated,this)},i.onDestroy=function(){h.instance.targetOff(this)},i.loadLevel=function(e){var t=this,r="levels/level_"+e;v.load(r,u,(function(r,s){if(r){console.error("Failed to load level "+e+":",r);var o=t.generateDefaultLevel(e);t.setupLevel(o)}else{var n=s.json;t.setupLevel(n)}}))},i.loadLevelFromConfig=function(e){this.setupLevel(e)},i.setupLevel=function(e){this._currentLevel=e,this._goals=e.goals.map((function(e){return n({},e,{current:0})})),this.boardManager.setMoves(e.maxMoves),this.boardManager.setGemTypes(e.gemTypes),this.boardManager.initBoard({rows:e.rows,cols:e.cols,gemTypes:e.gemTypes}),this._isLevelActive=!0,h.instance.emit(D.LEVEL_LOADED,e),h.instance.emit(D.LEVEL_START,e),console.log("Level "+e.id+' loaded: "'+e.name+'"')},i.onMatchFound=function(e){if(this._isLevelActive)for(var t,r=l(e);!(t=r()).done;){var s=t.value;this.updateGoalProgress(p.CollectColor,1,s.color),s.specialToCreate!==E.Normal&&this.updateGoalProgress(p.CollectSpecial,1,void 0,s.specialToCreate)}},i.onGemEliminated=function(e){},i.onScoreChanged=function(e){var t=this;this._isLevelActive&&(this.updateGoalProgress(p.Score,e.score,void 0,void 0,!0),e.movesLeft<=0&&this.scheduleOnce((function(){return t.checkLevelEnd()}),1))},i.onSpecialActivated=function(e,t){},i.onObstacleDestroyed=function(){this.updateGoalProgress(p.ClearObstacles,1)},i.onBossDefeated=function(){this.updateGoalProgress(p.DefeatBoss,1)},i.updateGoalProgress=function(e,t,r,s,o){void 0===o&&(o=!1);for(var n,a=l(this._goals);!(n=a()).done;){var i=n.value;i.type===e&&(e===p.CollectColor&&i.color!==r||e===p.CollectSpecial&&i.specialType!==s||(o?i.current=t:i.current+=t,h.instance.emit(D.GOAL_PROGRESS,i),i.current>=i.target&&this.checkLevelEnd()))}},i.checkLevelEnd=function(){this._isLevelActive&&this._currentLevel&&(this._goals.every((function(e){return e.current>=e.target}))?this.completeLevelSuccess():this.boardManager.movesLeft<=0&&this.completeLevelFailed())},i.completeLevelSuccess=function(){var e;this._isLevelActive=!1;var t=this._currentLevel,r=this.boardManager.score,s=1;r>=t.starThresholds.threeStar?s=3:r>=t.starThresholds.twoStar&&(s=2);var o={levelId:t.id,completed:!0,stars:s,highScore:r,attempts:((null==(e=this._levelProgress.get(t.id))?void 0:e.attempts)||0)+1};this._levelProgress.set(t.id,o),h.instance.emit(D.LEVEL_COMPLETE,{levelId:t.id,stars:s,score:r,rewards:t.rewards}),console.log("Level "+t.id+" complete! Stars: "+s+", Score: "+r)},i.completeLevelFailed=function(){this._isLevelActive=!1;var e=this._currentLevel,t=this._levelProgress.get(e.id)||{levelId:e.id,completed:!1,stars:0,highScore:0,attempts:0};t.attempts++,this._levelProgress.set(e.id,t),h.instance.emit(D.LEVEL_FAILED,{levelId:e.id,score:this.boardManager.score,goalsRemaining:this._goals.filter((function(e){return e.current<e.target}))}),console.log("Level "+e.id+" failed!")},i.generateDefaultLevel=function(e){var t=Math.ceil(e/10),r=e%10==0,s=r?f.Boss:e%10<=3?f.Easy:e%10<=7?f.Normal:f.Hard,o=25+2*Math.floor(e/5),n=1e3+500*e,l=Math.min(4+Math.floor(e/10),8),a=[];return r?a.push({type:p.DefeatBoss,target:1,current:0}):(a.push({type:p.Score,target:n,current:0}),e>=5&&a.push({type:p.CollectColor,target:10+e,current:0,color:e%6})),{id:e,name:"å…³å¡ "+e,chapter:t,difficulty:s,rows:9,cols:7,gemTypes:l,maxMoves:o,goals:a,starThresholds:{oneStar:n,twoStar:Math.floor(1.5*n),threeStar:2*n},rewards:{coins:50+10*e,exp:10+5*e,starDust:r?5:0}}},i.getLevelProgress=function(e){return this._levelProgress.get(e)},i.isLevelUnlocked=function(e){if(e<=1)return!0;var t=this._levelProgress.get(e-1);return!(null==t||!t.completed)},a(t,[{key:"currentLevel",get:function(){return this._currentLevel}},{key:"isLevelActive",get:function(){return this._isLevelActive}},{key:"goals",get:function(){return this._goals}}]),t}(d)).prototype,"boardManager",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=y))||S));i._RF.pop()}}}));

System.register("bundle://main/_virtual/LevelTypes.ts",["cc"],(function(e){var o;return{setters:[function(e){o=e.cclegacy}],execute:function(){o._RF.push({},"227e4trAYVAy6yzZPOfZvFP","LevelTypes",void 0);e("LevelGoalType",function(e){return e.Score="score",e.CollectColor="collect_color",e.ClearObstacles="clear_obstacles",e.DefeatBoss="defeat_boss",e.Survive="survive",e.CollectSpecial="collect_special",e}({})),e("LevelDifficulty",function(e){return e.Easy="easy",e.Normal="normal",e.Hard="hard",e.Boss="boss",e.Event="event",e}({})),e("ObstacleType",function(e){return e.Ice="ice",e.Stone="stone",e.Chain="chain",e.Fog="fog",e.Poison="poison",e.Portal="portal",e}({})),e("BossSkillType",function(e){return e.Petrify="petrify",e.LockGems="lock_gems",e.PoisonSpread="poison_spread",e.ReduceMoves="reduce_moves",e.Shield="shield",e.ColorShift="color_shift",e.Heal="heal",e}({})),e("TutorialStepType",function(e){return e.Dialog="dialog",e.TapGuide="tap_guide",e.SwipeGuide="swipe_guide",e.Highlight="highlight",e.WaitCondition="wait_condition",e}({}));o._RF.pop()}}}));

System.register("bundle://main/_virtual/main",["./EventCenter.ts","./AudioManager.ts","./BoardManager.ts","./BossManager.ts","./DamageCalculator.ts","./FallEngine.ts","./GameController.ts","./LevelConfigs.ts","./LevelManager.ts","./MatchEngine.ts","./ObstacleManager.ts","./SpecialGemFactory.ts","./TutorialManager.ts","./GameTypes.ts","./LevelTypes.ts","./BoardView.ts","./GameBackground.ts","./GameOverPopup.ts","./GameUIView.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("bundle://main/_virtual/MatchEngine.ts",["cc","./GameTypes.ts"],(function(o){var r,e,l,n;return{setters:[function(o){r=o.cclegacy},function(o){e=o.SpecialType,l=o.COLOR_ELEMENT_MAP,n=o.GemColor}],execute:function(){r._RF.push({},"56eb4D19vFI+6fXSlMKHI/z","MatchEngine",void 0);o("MatchEngine",function(){function o(){}return o.findAllMatches=function(o){for(var r=o.length,n=o[0].length,t=[],c=[],a=[],s=0;s<r;s++){for(var i=[],h=0;h<n;h++){var u=o[s][h];if(this.isValidGem(u))if(0===i.length)i.push(u);else i[i.length-1].color===u.color?i.push(u):(i.length>=3&&c.push({gems:[].concat(i),row:s}),i=[u]);else i.length>=3&&c.push({gems:[].concat(i),row:s}),i=[]}i.length>=3&&c.push({gems:[].concat(i),row:s})}for(var g=0;g<n;g++){for(var f=[],p=0;p<r;p++){var m=o[p][g];if(this.isValidGem(m))if(0===f.length)f.push(m);else f[f.length-1].color===m.color?f.push(m):(f.length>=3&&a.push({gems:[].concat(f),col:g}),f=[m]);else f.length>=3&&a.push({gems:[].concat(f),col:g}),f=[]}f.length>=3&&a.push({gems:[].concat(f),col:g})}for(var w=new Set,v=function(){var o=c[d],r=o.gems.length,n="horizontal",s={row:-1,col:-1},i=new Map;o.gems.forEach((function(o){return i.set(o.row+","+o.col,o)}));for(var h=[],u=function(){if(w.has(g))return 0;var r=a[g];if(o.gems[0].color!==r.gems[0].color)return 0;var e=o.gems.find((function(o){return r.gems.some((function(r){return r.row===o.row&&r.col===o.col}))}));e&&(r.gems.forEach((function(o){return i.set(o.row+","+o.col,o)})),w.add(g),h.push(r.gems.length),s={row:e.row,col:e.col})},g=0;g<a.length;g++)u();var f=Array.from(i.values()),p=f.length,m=f[0].color,v=e.Normal;if(h.length>0){var M=Math.max.apply(Math,h);r>=3&&M>=3&&(n="L",h.length>=2||r>=5&&M>=3||r>=3&&M>=5?n="cross":(r>=4||M>=4)&&(n="T"))}if(p>=7?(v=e.BlackHole,n="cross"):p>=6?v=e.BlackHole:"L"===n||"T"===n||"cross"===n?v=e.Bomb:5===p?v=e.Star:4===p&&(v=e.Lightning),-1===s.row){var S=Math.floor(f.length/2);s={row:f[S].row,col:f[S].col}}t.push({gems:f.map((function(o){return{row:o.row,col:o.col}})),matchType:n,count:p,specialToCreate:v,specialPosition:s,color:m,element:l[m]})},d=0;d<c.length;d++)v();for(var M=0;M<a.length;M++)if(!w.has(M)){var S=a[M],T=S.gems.length,y=S.gems[0].color,E=e.Normal;T>=6?E=e.BlackHole:T>=5?E=e.Star:4===T&&(E=e.Lightning);var b=Math.floor(T/2),L={row:S.gems[b].row,col:S.gems[b].col};t.push({gems:S.gems.map((function(o){return{row:o.row,col:o.col}})),matchType:"vertical",count:T,specialToCreate:E,specialPosition:L,color:y,element:l[y]})}return t},o.isValidGem=function(o){return o&&o.color!==n.None&&!o.hidden},o.isValidSwap=function(o,r,l){var n=o[r.row][r.col],t=o[l.row][l.col];if(!n||!t)return!1;if(n.locked||t.locked)return!1;if(n.hp>0||t.hp>0)return!1;if(Math.abs(r.row-l.row)+Math.abs(r.col-l.col)!==1)return!1;if(n.special!==e.Normal||t.special!==e.Normal)return!0;var c=n.color,a=n.special,s=t.color,i=t.special;n.color=s,n.special=i,t.color=c,t.special=a;var h=this.findAllMatches(o).length>0;return n.color=c,n.special=a,t.color=s,t.special=i,h},o.hasAvailableMoves=function(o){for(var r=o.length,e=o[0].length,l=0;l<r;l++)for(var n=0;n<e;n++){if(n<e-1&&this.isValidSwap(o,{row:l,col:n},{row:l,col:n+1}))return!0;if(l<r-1&&this.isValidSwap(o,{row:l,col:n},{row:l+1,col:n}))return!0}return!1},o}());r._RF.pop()}}}));

System.register("bundle://main/_virtual/ObstacleManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventCenter.ts","./BoardManager.ts","./LevelTypes.ts"],(function(e){var t,r,a,n,o,i,s,c,l,d,u,h,p,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,a=e.initializerDefineProperty,n=e.assertThisInitialized,o=e.createForOfIteratorHelperLoose,i=e.extends,s=e.createClass},function(e){c=e.cclegacy,l=e._decorator,d=e.Component},function(e){u=e.EventCenter,h=e.GAME_EVENTS},function(e){p=e.BoardManager},function(e){g=e.ObstacleType}],execute:function(){var f,b,y,v,_;c._RF.push({},"b1522JFG3NN4Kaa8i35Zpv8","ObstacleManager",void 0);var A=l.ccclass,E=l.property,O=e("OBSTACLE_EVENTS",{OBSTACLE_CREATED:"obstacle:created",OBSTACLE_DAMAGED:"obstacle:damaged",OBSTACLE_DESTROYED:"obstacle:destroyed",POISON_SPREAD:"obstacle:poison_spread",PORTAL_ACTIVATE:"obstacle:portal_activate"}),M=0;e("ObstacleManager",(f=A("ObstacleManager"),b=E(p),f((_=t((v=function(e){function t(){for(var t,r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=e.call.apply(e,[this].concat(o))||this,a(t,"boardManager",_,n(t)),t._obstacles=new Map,t._gridMap=new Map,t}r(t,e);var c=t.prototype;return c.onLoad=function(){u.instance.on(h.GEM_ELIMINATED,this.onAdjacentElimination,this),u.instance.on(h.SPECIAL_ACTIVATED,this.onSpecialActivated,this),u.instance.on(h.SCORE_CHANGED,this.onTurnEnd,this)},c.onDestroy=function(){u.instance.targetOff(this)},c.initObstacles=function(e){this.clearAll();for(var t,r=o(e);!(t=r()).done;){var a=t.value;this.addObstacle(a)}},c.addObstacle=function(e){var t="obstacle_"+ ++M,r=i({},e,{id:t,currentHp:e.hp,destroyed:!1});if(this._obstacles.set(t,r),this._gridMap.set(this.gridKey(e.row,e.col),t),e.type===g.Stone){var a=this.boardManager.getGemAt(e.row,e.col);a&&(a.locked=!0,a.hidden=!0)}return u.instance.emit(O.OBSTACLE_CREATED,r),r},c.clearAll=function(){this._obstacles.clear(),this._gridMap.clear()},c.onAdjacentElimination=function(e){for(var t=0,r=[{dr:-1,dc:0},{dr:1,dc:0},{dr:0,dc:-1},{dr:0,dc:1}];t<r.length;t++){var a=r[t],n=e.row+a.dr,o=e.col+a.dc,i=this.gridKey(n,o),s=this._gridMap.get(i);s&&this.damageObstacle(s,1)}},c.onSpecialActivated=function(e,t){for(var r,a=o(t);!(r=a()).done;){var n=r.value,i=this.gridKey(n.row,n.col),s=this._gridMap.get(i);if(s){var c=this._obstacles.get(s);c&&c.vulnerableToSpecial&&this.damageObstacle(s,c.currentHp)}}},c.damageObstacle=function(e,t){var r=this._obstacles.get(e);r&&!r.destroyed&&(r.currentHp=Math.max(0,r.currentHp-t),u.instance.emit(O.OBSTACLE_DAMAGED,{id:r.id,type:r.type,row:r.row,col:r.col,currentHp:r.currentHp,maxHp:r.hp}),r.currentHp<=0&&this.destroyObstacle(e))},c.destroyObstacle=function(e){var t=this._obstacles.get(e);if(t){if(t.destroyed=!0,this._gridMap.delete(this.gridKey(t.row,t.col)),t.type===g.Stone){var r=this.boardManager.getGemAt(t.row,t.col);r&&(r.locked=!1,r.hidden=!1)}u.instance.emit(O.OBSTACLE_DESTROYED,{id:t.id,type:t.type,row:t.row,col:t.col}),u.instance.emit("OBSTACLE_DESTROYED"),console.log("Obstacle "+t.type+" at ("+t.row+", "+t.col+") destroyed!")}},c.onTurnEnd=function(e){this.spreadPoison()},c.spreadPoison=function(){var e=Array.from(this._obstacles.values()).filter((function(e){return e.type===g.Poison&&!e.destroyed}));if(0!==e.length){for(var t,r=[],a=[{dr:-1,dc:0},{dr:1,dc:0},{dr:0,dc:-1},{dr:0,dc:1}],n=o(e);!(t=n()).done;)for(var i,s=t.value,c=o(a);!(i=c()).done;){var l=i.value,d=s.row+l.dr,h=s.col+l.dc,p=this.gridKey(d,h);if(!this._gridMap.has(p))this.boardManager.getGemAt(d,h)&&Math.random()<.5&&r.push({row:d,col:h})}for(var f=0,b=r;f<b.length;f++){var y=b[f],v=this.gridKey(y.row,y.col);if(!this._gridMap.has(v)){this.addObstacle({type:g.Poison,hp:1,row:y.row,col:y.col,blocksFall:!1,vulnerableToSpecial:!0});var _=this.boardManager.getGemAt(y.row,y.col);_&&(_.poisoned=!0)}}r.length>0&&u.instance.emit(O.POISON_SPREAD,r)}},c.getObstacleAt=function(e,t){var r=this._gridMap.get(this.gridKey(e,t));return r&&this._obstacles.get(r)||null},c.hasObstacleAt=function(e,t){return this._gridMap.has(this.gridKey(e,t))},c.getObstaclesByType=function(e){return Array.from(this._obstacles.values()).filter((function(t){return t.type===e&&!t.destroyed}))},c.gridKey=function(e,t){return e+","+t},s(t,[{key:"obstacles",get:function(){return Array.from(this._obstacles.values())}},{key:"remainingCount",get:function(){return Array.from(this._obstacles.values()).filter((function(e){return!e.destroyed})).length}}]),t}(d)).prototype,"boardManager",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=v))||y));c._RF.pop()}}}));

System.register("bundle://main/_virtual/rollupPluginModLoBabelHelpers.js",[],(function(t){return{execute:function(){function r(t,r,e,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void e(t)}u.done?r(c):Promise.resolve(c).then(n,o)}function e(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,c(n.key),n)}}function n(){return(n=t("extends",Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t})).apply(this,arguments)}function o(r,e){return(o=t("setPrototypeOf",Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t}))(r,e)}function i(t,r){if(t){if("string"==typeof t)return a(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?a(t,r):void 0}}function a(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function u(t,r){if("object"!=typeof t||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,r||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}function c(t){var r=u(t,"string");return"symbol"==typeof r?r:String(r)}t({applyDecoratedDescriptor:function(t,r,e,n,o){var i={};Object.keys(n).forEach((function(t){i[t]=n[t]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0);i=e.slice().reverse().reduce((function(e,n){return n(t,r,e)||e}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0);void 0===i.initializer&&(Object.defineProperty(t,r,i),i=null);return i},arrayLikeToArray:a,assertThisInitialized:function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},asyncToGenerator:function(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var a=t.apply(e,n);function u(t){r(a,o,i,u,c,"next",t)}function c(t){r(a,o,i,u,c,"throw",t)}u(void 0)}))}},createClass:function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return Object.defineProperty(t,"prototype",{writable:!1}),t},createForOfIteratorHelperLoose:function(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=i(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},extends:n,inheritsLoose:function(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,o(t,r)},initializerDefineProperty:function(t,r,e,n){if(!e)return;Object.defineProperty(t,r,{enumerable:e.enumerable,configurable:e.configurable,writable:e.writable,value:e.initializer?e.initializer.call(n):void 0})},regeneratorRuntime:function(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
t("regeneratorRuntime",(function(){return e}));var r,e={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(t,r,e){t[r]=e.value},a="function"==typeof Symbol?Symbol:{},u=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function f(t,r,e){return Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{f({},"")}catch(r){f=function(t,r,e){return t[r]=e}}function s(t,r,e,n){var o=r&&r.prototype instanceof g?r:g,a=Object.create(o.prototype),u=new k(n||[]);return i(a,"_invoke",{value:P(t,e,u)}),a}function h(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}e.wrap=s;var p="suspendedStart",y="executing",v="completed",d={};function g(){}function m(){}function b(){}var w={};f(w,u,(function(){return this}));var O=Object.getPrototypeOf,L=O&&O(O(z([])));L&&L!==n&&o.call(L,u)&&(w=L);var j=b.prototype=g.prototype=Object.create(w);function x(t){["next","throw","return"].forEach((function(r){f(t,r,(function(t){return this._invoke(r,t)}))}))}function E(t,r){function e(n,i,a,u){var c=h(t[n],t,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==typeof f&&o.call(f,"__await")?r.resolve(f.__await).then((function(t){e("next",t,a,u)}),(function(t){e("throw",t,a,u)})):r.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return e("throw",t,a,u)}))}u(c.arg)}var n;i(this,"_invoke",{value:function(t,o){function i(){return new r((function(r,n){e(t,o,r,n)}))}return n=n?n.then(i,i):i()}})}function P(t,e,n){var o=p;return function(i,a){if(o===y)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:r,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=_(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var l=h(t,e,n);if("normal"===l.type){if(o=n.done?v:"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function _(t,e){var n=e.method,o=t.iterator[n];if(o===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=r,_(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=h(o,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,d;var a=i.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,d):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function S(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function T(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function z(t){if(t||""===t){var e=t[u];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(o.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=r,e.done=!0,e};return i.next=i}}throw new TypeError(typeof t+" is not iterable")}return m.prototype=b,i(j,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:m,configurable:!0}),m.displayName=f(b,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===m||"GeneratorFunction"===(r.displayName||r.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,f(t,l,"GeneratorFunction")),t.prototype=Object.create(j),t},e.awrap=function(t){return{__await:t}},x(E.prototype),f(E.prototype,c,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new E(s(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(j),f(j,l,"Generator"),f(j,u,(function(){return this})),f(j,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var r=Object(t),e=[];for(var n in r)e.push(n);return e.reverse(),function t(){for(;e.length;){var n=e.pop();if(n in r)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=z,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(T),!t)for(var e in this)"t"===e.charAt(0)&&o.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,o){return u.type="throw",u.arg=t,e.next=n,o&&(e.method="next",e.arg=r),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),l=o.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,r){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=r,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),d},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),T(e),d}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;T(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:z(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),d}},e},setPrototypeOf:o,toPrimitive:u,toPropertyKey:c,unsupportedIterableToArray:i})}}}));

System.register("bundle://main/_virtual/SpecialGemFactory.ts",["cc","./GameTypes.ts"],(function(r){var o,c;return{setters:[function(r){o=r.cclegacy},function(r){c=r.SpecialType}],execute:function(){o._RF.push({},"e71c67J0BZI2Y3xRXr3RXx5","SpecialGemFactory",void 0);r("SpecialGemFactory",function(){function r(){}return r.getActivationEffect=function(r,o){var a=o.length,t=o[0].length,e=[];if(!r)return e;switch(r.special){case c.Lightning:for(var l=0;l<t;l++)e.push({row:r.row,col:l});for(var n=0;n<a;n++)n!==r.row&&e.push({row:n,col:r.col});break;case c.Bomb:for(var i=r.row-1;i<=r.row+1;i++)for(var f=r.col-1;f<=r.col+1;f++)i>=0&&i<a&&f>=0&&f<t&&e.push({row:i,col:f});break;case c.Star:console.warn("SpecialGemFactory: Star activation requires target color context.");break;case c.BlackHole:for(var u=r.row-2;u<=r.row+2;u++)for(var s=r.col-2;s<=r.col+2;s++)u>=0&&u<a&&s>=0&&s<t&&e.push({row:u,col:s})}return e},r.getCombinationEffect=function(r,o,a){var t=a.length,e=a[0].length,l=[],n=r.special,i=o.special;if(n===c.Lightning&&i===c.Lightning){for(var f=0;f<e;f++)l.push({row:r.row,col:f});for(var u=0;u<t;u++)l.push({row:u,col:r.col});if(r.row!==o.row)for(var s=0;s<e;s++)l.push({row:o.row,col:s});if(r.col!==o.col)for(var v=0;v<t;v++)l.push({row:v,col:o.col});return l}if(n===c.Lightning&&i===c.Bomb||n===c.Bomb&&i===c.Lightning){for(var w=r.row,p=r.col,h=w-1;h<=w+1;h++)if(h>=0&&h<t)for(var g=0;g<e;g++)l.push({row:h,col:g});for(var S=p-1;S<=p+1;S++)if(S>=0&&S<e)for(var m=0;m<t;m++)l.push({row:m,col:S});return l}if(n===c.Bomb&&i===c.Bomb){for(var b=r.row,B=r.col,y=b-2;y<=b+2;y++)for(var k=B-2;k<=B+2;k++)y>=0&&y<t&&k>=0&&k<e&&l.push({row:y,col:k});return l}if(n===c.Star&&i===c.Star){for(var F=0;F<t;F++)for(var G=0;G<e;G++)l.push({row:F,col:G});return l}if(n===c.Star||i===c.Star){c.Star;for(var L=n===c.Star?o:r,x=0;x<t;x++)for(var R=0;R<e;R++){var H=a[x][R];H&&H.color===L.color&&l.push({row:x,col:R})}return l}if(n===c.BlackHole||i===c.BlackHole){for(var _=0;_<t;_++)for(var d=0;d<e;d++)l.push({row:_,col:d});return l}return l},r}());o._RF.pop()}}}));

System.register("bundle://main/_virtual/TutorialManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventCenter.ts"],(function(t){var e,i,r,n,a,s,o;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose,r=t.createClass},function(t){n=t.cclegacy,a=t._decorator,s=t.Component},function(t){o=t.EventCenter}],execute:function(){var u;n._RF.push({},"3272bKju1FEIaWt6O5OXNoS","TutorialManager",void 0);var c=a.ccclass,l=(a.property,t("TUTORIAL_EVENTS",{TUTORIAL_START:"tutorial:start",TUTORIAL_STEP:"tutorial:step",TUTORIAL_END:"tutorial:end"}));t("TutorialManager",c("TutorialManager")(u=function(t){function n(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._activeTutorial=null,e._currentStepIndex=-1,e._completedTutorials=new Set,e._isActive=!1,e}e(n,t);var a=n.prototype;return a.startTutorial=function(t){t.oneTime&&this._completedTutorials.has(t.id)||(this._activeTutorial=t,this._currentStepIndex=0,this._isActive=!0,o.instance.emit(l.TUTORIAL_START,t),console.log('Tutorial "'+t.id+'" started'),this.executeCurrentStep())},a.nextStep=function(){this._activeTutorial&&this._isActive&&(this._currentStepIndex++,this._currentStepIndex>=this._activeTutorial.steps.length?this.endTutorial():this.executeCurrentStep())},a.skipTutorial=function(){this._activeTutorial&&this._completedTutorials.add(this._activeTutorial.id),this._isActive=!1,this._activeTutorial=null,this._currentStepIndex=-1,o.instance.emit(l.TUTORIAL_END,{skipped:!0})},a.executeCurrentStep=function(){var t=this;if(this._activeTutorial){var e=this._activeTutorial.steps[this._currentStepIndex];e&&(o.instance.emit(l.TUTORIAL_STEP,{stepIndex:this._currentStepIndex,totalSteps:this._activeTutorial.steps.length,step:e}),e.delay&&e.delay>0&&this.scheduleOnce((function(){return t.nextStep()}),e.delay/1e3))}},a.endTutorial=function(){this._activeTutorial&&(this._completedTutorials.add(this._activeTutorial.id),console.log('Tutorial "'+this._activeTutorial.id+'" completed')),this._isActive=!1,this._activeTutorial=null,this._currentStepIndex=-1,o.instance.emit(l.TUTORIAL_END,{skipped:!1})},a.checkTutorialForLevel=function(t,e){for(var r,n=i(e);!(r=n()).done;){var a=r.value;if(a.triggerLevel===t)return void this.startTutorial(a)}},a.isTutorialCompleted=function(t){return this._completedTutorials.has(t)},r(n,[{key:"isActive",get:function(){return this._isActive}}]),n}(s))||u);n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'bundle://main/_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});